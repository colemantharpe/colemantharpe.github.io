/**
 * web-kiosk-sdk - Web Kiosk SDK.
 * @version v2.7.3
 */
!function(){"use strict";angular.module("aqf.webkiosk.titlesDetail",["aqf.app.titles"])}(),function(){"use strict";function e(e,t,n,a,r,i,o,s){function l(){c(),r.get(u.id,"fr").then(function(e){u.title=e,u.title.metadata.physicalData&&u.title.metadata.physicalData.cover&&0!==u.title.metadata.physicalData.cover.height&&(u.thumbnailRatio=u.title.metadata.physicalData.cover.width/u.title.metadata.physicalData.cover.height),u.coverIds=u.title.headerImages,i.getAll(u.id).then(function(e){u.issues=e,_.each(u.issues,function(e){e.linkParams={state:"issue",params:{itemId:e.id}}}),u.isLoading=!1}),s.sendPageTrack("title_"+u.title.defaultName)},function(e){n.error("An error occurend : ",e)});var a=angular.element(e);a.bind("resize",function(){c(),t.$apply()})}function c(){u.coverImageWidth=e.innerWidth,u.coverImageHeight=250}var u=this;u.id=o.itemId,u.config=a,u.coverIds=[],u.coverImageWidth=0,u.coverImageHeight=250,u.tileHeight=250,u.isLoading=!0,u.issues=[],u.thumbnailRatio=1,u.init=l,u.init()}e.$inject=["$window","$scope","$log","configKiosk","aqfTitleService","aqfIssueService","$stateParams","aqfAppAnalyticsService"],angular.module("aqf.webkiosk.titlesDetail").controller("TitlesDetailController",e)}(),function(){"use strict";angular.module("aqf.webkiosk.titlesDetail").config(["$stateProvider","configKiosk",function(e,t){e.state("title",{parent:"titles",url:"/:itemId",data:{needLogin:t.authConfig.forceLogin},views:{"@app":{templateUrl:"app/views/titlesDetail/templates/titlesDetail.html",controller:"TitlesDetailController",controllerAs:"titlesDetailController"}}})}])}(),function(){"use strict";angular.module("aqf.webkiosk.titles",["aqf.app.titles","aqf.webkiosk.titlesDetail"])}(),function(){"use strict";function e(e,t,n,a,r,i){function o(){s(),r.getAll(l.locale).then(function(e){l.titles=e,_.each(l.titles,function(e){e.metadata.physicalData&&e.metadata.physicalData.cover&&0!==e.metadata.physicalData.cover.height&&(l.ratios[e.id]=e.metadata.physicalData.cover.width/e.metadata.physicalData.cover.height),_.isArray(e.coverIds)||(e.coverIds=[]),_.each(e.headerImages,function(t){e.coverIds.push(t.id)}),e.linkParams={state:"title",params:{itemId:e.id}}}),l.isLoading=!1},function(e){n.error("An error occured : ",e)});var a=angular.element(e);a.bind("resize",function(){s(),t.$apply()})}function s(){l.coverImageWidth=e.innerWidth,l.coverImageHeight=250}var l=this;l.locale=i.locale,l.config=a,l.coverImageWidth=0,l.coverImageHeight=250,l.tileHeight=250,l.isLoading=!0,l.thumbnailRatio=1,l.ratios={},l.init=o,l.init()}e.$inject=["$window","$scope","$log","configKiosk","aqfTitleService","$stateParams"],angular.module("aqf.webkiosk.titles").controller("TitlesController",e)}(),function(){"use strict";angular.module("aqf.webkiosk.titles").config(["$stateProvider","configKiosk",function(e,t){e.state("titles",{parent:"app",url:"/titles",data:{needLogin:t.authConfig.forceLogin},views:{"@app":{templateUrl:"app/views/titles/templates/titles.html",controller:"TitlesController",controllerAs:"titlesController"}}})}])}(),function(){angular.module("aqf.webkiosk.storemodel",["aqf.config","aqf.webkiosk.config","aqf.ui.router","aqf.storemodel","aqf-storemodel.tpl","aqf.storemodel.element.list","aqf-storemodel-element-list.tpl","aqf.storemodel.element.banner","aqf-storemodel-element-banner.tpl","aqf.storemodel.element.video","aqf-storemodel-element-video.tpl","aqf.storemodel.element.webview","aqf-storemodel-element-webview.tpl","aqf.storemodel.element.grid","aqf-storemodel-element-grid.tpl","aqf.storemodel.element.spotlight","aqf-storemodel-element-spotlight.tpl"])}(),function(){"use strict";function e(e){var t=this;t.key=e.smkey,t.locale=e.smlocale?e.smlocale:e.locale}e.$inject=["$stateParams"],angular.module("aqf.webkiosk.storemodel").controller("StoremodelController",e)}(),function(){angular.module("aqf.webkiosk.storemodel").config(["$stateProvider","configKiosk",function(e,t){e.state("storemodel",{parent:"app",url:"/storemodel/:smkey",data:{needLogin:t.authConfig.forceLogin},views:{"@app":{templateUrl:"app/views/storemodel/templates/storemodel.template.html",controller:"StoremodelController",controllerAs:"storemodelController"}}}),e.state("storemodelwithlang",{parent:"storemodel",url:"/:smlocale"})}])}(),function(){"use strict";angular.module("aqf.webkiosk.signup",["ngPassword","aqf.ui.router","pascalprecht.translate","aqf.app.user","aqf.app.analytics"])}(),function(){"use strict";function e(e,t,n){function a(){n.sendPageTrack("account")}function r(){n.sendEventTrack("va_signup"),o.messages=[],o.form.$invalid?(o.messages.push({type:"error",text:e.instant("signup.error.invalidform")}),o.form.passwordConfirm.$error&&o.messages.push({type:"error",text:e.instant("signup.error.pwdmismatch")})):t.signup(o.model).then(function(t){"204"===t.status?o.messages.push({type:"error",text:e.instant("signup.error.invalidpassword")}):(n.sendEventTrack("va_signup_success"),o.messages.push({type:"msg",text:e.instant("signup.creationok")}))},function(t){o.messages.push({type:"error",text:e.instant("signup.error.wentwrong",{message:t.result.message})})})}function i(){o.messages=[],o.model={email:"",password:"",passwordConfirm:""},o.form.$setPristine()}var o=this;o.model={email:"",password:"",passwordConfirm:""},o.messages=[],o.form={},o.init=a,o.signup=r,o.resetForm=i,a()}e.$inject=["$translate","aqfUserService","aqfAppAnalyticsService"],angular.module("aqf.webkiosk.signup").controller("SignupController",e)}(),function(){angular.module("aqf.webkiosk.signup").config(["$stateProvider",function(e){e.state("signup",{url:":locale/signup",parent:"main",data:{needLogin:!1},views:{"@main":{templateUrl:"app/views/signup/templates/signup.template.html",controller:"SignupController",controllerAs:"signupController"}}})}])}(),function(){"use strict";angular.module("aqf.webkiosk.search",["aqf.ui.router","aqf.app.search","cfp.hotkeys","yaru22.angular-timeago"])}(),function(){"use strict";angular.module("aqf.webkiosk.search").controller("SearchController",["$scope","$state","$stateParams","$timeout","kioskSearchService","aqfAppAnalyticsService","kioskReaderService","hotkeys",function(e,t,n,a,r,i,o,s){function l(){T.searchHistory=r.getSearchHistory(),P=_.debounce(T.search,500),e.$watch(function(){return r.isDisplay},function(e,t){!t&&e?(i.sendPageTrack("search"),a(function(){angular.element(".search-input").focus(),s.add({combo:"esc",allowIn:["INPUT"],callback:function(){S(),angular.element(".search-input").focus()}})})):t&&!e&&s.del("esc")})}function c(){P(),f()}function u(e){w(),e&&f(e);var t=e||T.input||null;if(!_.isEmpty(t)){T.input=t;var n={size:A};r.deepSearch(t,n).then(function(e){T.numResults=e.total,T.searchResult=e.hits,v()},function(e){"error.noresult"===e&&(T.noResults=!0)})}}function f(e){_.isNull(D)||a.cancel(D),D=a(function(){i.sendEventTrack("vsh_search_request",{searchTerms:e||T.input,resultCount:T.numResults}),r.saveSearchInSearchHistory(e||T.input),T.searchHistory=r.getSearchHistory()},L)}function d(e,t){var n=e.id,a=null,o=null;if(!(e._contains.length>0))return y(e),void i.sendEventTrack("vsh_header_click",{issueName:e.name,titleName:e.title_name["default"]});T.spotlightedIssue=e,a=e._contains[0].zave_id,o=e._contains[0].reader_id,i.sendEventTrack("vsh_searchResult_click",{issueName:e.name,titleName:e.title_name["default"]});var s={where:"pages",issueId:n,zaveId:a,readerId:o,size:A};t?s.from=T.inIssueSearchResult.length:T.inIssueSearchResult=[],r.deepSearch(T.input,s).then(function(e){T.inIssueSearchResult=T.inIssueSearchResult.concat(e.hits),T.numResultsInIssue=e.total,k()},function(e){"error.noresult"===e?T.noResults=!0:console.error("An error occured while searching for "+T.input+". "+e)})}function g(){d(T.spotlightedIssue,!0)}function p(){if(T.canLoadMoreIssues()){T.isLoading=!0;var e={from:T.searchResult.length,size:A};r.deepSearch(T.input,e).then(function(e){T.searchResult=T.searchResult.concat(e.hits),T.isLoading=!1},function(){T.isLoading=!1})}}function m(){return T.inIssueSearchResult.length<T.numResultsInIssue}function h(){return!_.isUndefined(T.input)&&_.isObject(T.searchResult)&&T.searchResult.length<T.numResults}function v(){var e=angular.element(".search-list");e.unbind("scroll"),e.bind("scroll",function(){var t=e[0];t.scrollTop+t.offsetHeight>=t.scrollHeight&&!_.isUndefined(T.input)&&T.loadMoreIssues()})}function k(){var e=angular.element(".inpages-search-results .results");e.bind("scroll",function(){var t=e[0];t.scrollTop+t.offsetHeight>=t.scrollHeight&&!_.isUndefined(T.input)&&T.loadMorePages()})}function b(){T.spotlightedIssue=null,T.inIssueSearchResult={}}function y(e){i.sendEventTrack("vsh_header_click",{issueName:e.name,titleName:e.title_name["default"]}),r.toggleSearch(),t.go("issue",{itemId:e.id})}function I(e){i.sendEventTrack("vsh_article_click",{issueName:e.name,titleName:e.title_name["default"]}),t.go("read",{locale:n.locale,itemId:e.id})}function q(e){var a=o.parseReaderDeepLink(e._deeplink);i.sendEventTrack("vsh_article_click",{issueName:T.spotlightedIssue.name,titleName:T.spotlightedIssue.title_name["default"]}),t.go("read",{locale:n.locale,itemId:a.issue,location:a.section+"/"+a.spread+"/"+a.page,locationType:a.locationType})}function w(){T.noResults=!1,T.searchResult={},T.numResults=0,T.spotlightedIssue=null,T.inIssueSearchResult={}}function S(){T.input="",w()}function C(){a(function(){S()},500),r.toggleSearch()}function $(e){if(_.isObject(e)){var t=e.top>60?0:60-e.top;return{top:t}}}var T=this,A=15,L=2e3,D=null,P=null;T.input="",T.limitHistoryResult=20,T.numResults=0,T.numResultsInIssue=0,T.inIssueSearchResult=[],T.searchresult=[],T.searchHistory=[],T.searchService=r,T.spotlightedIssue=null,T.noResults=!1,T.isLoading=!1,T.search=u,T.searchInIssue=d,T.cancelInIssueSearch=b,T.resetInput=S,T.cancel=C,T.goToIssueView=y,T.getStyle=$,T.read=I,T.readPage=q,T.loadMoreIssues=p,T.loadMorePages=g,T.canLoadMoreIssues=h,T.canLoadMorePages=m,T.saveSearch=f,T.onInputChange=c,T.init=l,T.init()}])}(),function(){"use strict";angular.module("aqf.webkiosk.read",["aqf.config","aqf.webkiosk.config","aqf.ui.router","aqua.porthole","aqf.app.reader","aqf.app.issue","aqf.kioskModeDetector","aqf.webSocket","aqf.auth","aqf.webkiosk.component.auth"])}(),function(){"use strict";function e(e,t,n,a,r,i,o,s,l,c){function u(){y.isDesktopMode=i.isDesktopMode(),y.isOffline=i.isOffline(),y.readerOptions.locationType=n.locationType?n.locationType:void 0,y.readerOptions.location=n.location?n.location:void 0;var e=o.getFirebaseInfo();_.isNull(e)||(y.annotationsInfo={publisherId:e.publisherId,userId:e.uid,userInfo:{email:o.getUserId()},issueId:y.issueId,appId:l.app.applicationDetails.bundleId,firebase:l.firebase,token:o.getFirebaseToken()}),l.analytics&&(y.analyticsInfo=l.analytics),y.isDesktopMode&&y.isOffline?k():r.getIssue(y.issueId).then(function(e){y.issueModel=e,y.isDesktopMode?(y.isReadable=r.isReadable(y.issueModel,!0),y.isReadable?k(y.issueModel):(y.readerStatus="error",y.messages.push({type:"error",text:"read.error.noArchiveUrl"}))):(r.readIssue(y.issueModel).then(function(e){y.issue=e,y.issueIsLoaded=!0},function(e){y.messages.push({type:"error",text:"read.error.readIssue",error:e})}),y.isLoading=!1)},function(e){y.messages.push({type:"error",text:"read.error.getIssue",error:e})})}function f(){y.isDesktopMode&&y.isOffline?t.go("offlineLibrary",{locale:n.locale}):t.go("issue",{locale:n.locale,itemId:y.issueId})}function d(e){y.readerIsReady=e}function g(e){t.go("read",{indexPage:e},{notify:!1})}function p(){y.issueIsLoaded=!0}function m(){y.isLoading=!1,s.send({action:"download",userId:y.userId,issueId:y.issueId,name:y.issueModel.name,url:y.issueModel.getWebSource(i.isDesktopMode()).url,language:n.locale,coverUrl:r.getCoverUrl(y.issueModel.resources.thumbnailIds),version:y.issueModel.version})}function h(){s.send({action:"downloadnewversion",userId:y.userId,issueId:y.issueId,name:y.issueModel.name,url:y.issueModel.getWebSource(i.isDesktopMode()).url,language:n.locale,coverUrl:r.getCoverUrl(y.issueModel.resources.thumbnailIds),version:y.issueModel.version})}function v(e){o.firebaseRenewToken().then(function(t){e(t)})}function k(t){var n={};t&&(n.version=t.version),r.getReaderStatus(y.userId,y.issueId,n,function(t){var n=!1,a="error";switch(y.isLoading=!1,y.readerStatus=t.status,y.readerStatus){case"ready":y.iframeSrc=e.trustAsResourceUrl(t.url),y.issueIsLoaded=!0;break;case"downloading":b(),n=!0,a="msg";break;case"versionmismatch":y.versionsMismatch=!0,n=!0,y.iframeSrc=e.trustAsResourceUrl(t.url);break;default:n=!0}n&&y.messages.push({type:a,text:"error"===t.status?t.message:"read.error."+t.status})})}function b(){r.getDownloadProgress(y.userId,y.issueId,function(e){y.downloadPercentage=e.percentage})}var y=this;y.issueId=n.itemId,y.iframeName="iframeName"+y.issueId,y.iframeId="iframeId"+y.issueId,y.iframeSrc="",y.issue={},y.domain=a.location.origin,y.isLoading=!0,y.issueIsLoaded=!1,y.readerIsReady=!1,y.versionsMismatch=!1,y.messages=[],y.indexPage=n.indexPage||1,y.readerStatus=null,y.issueModel={},y.userId=c.isLoggedIn()?o.getUserId():"public",y.annotationsInfo=null,y.analyticsInfo=null,y.readerOptions={},y.init=u,y.onExit=f,y.onReaderReady=d,y.onGoToPage=g,y.read=p,y.download=m,y.downloadNewVersion=h,y.onFirebaseReauth=v,u()}e.$inject=["$sce","$state","$stateParams","$window","aqfIssueService","aqfKioskModeDetectorService","kioskAuthService","aqfWebSocketService","configKiosk","aqfAuthService"],angular.module("aqf.webkiosk.read").controller("ReadController",e)}(),function(){"use strict";angular.module("aqf.webkiosk.read").config(["$stateProvider",function(e){e.state("read",{parent:"issue",params:{indexPage:"1",location:void 0,locationType:void 0},url:"/read/:indexPage",views:{"@app":{templateUrl:"app/views/read/templates/read.template.html",controller:"ReadController",controllerAs:"readController"}}})}])}(),function(){"use strict";angular.module("aqf.webkiosk.profile",["aqf.app.voucher","ui.bootstrap","aqf.auth"])}(),function(){"use strict";function e(e,t,n,a,r){function i(){o(),s.formVoucher.$valid===!0?n.addVoucher(s.voucherCode).then(function(){s.voucherHasError=!1,s.voucherMessage="voucher.common.addedsuccessfully"},function(e){s.voucherHasError=!0,s.voucherMessage=e}):(s.voucherHasError=!0,s.voucherMessage="voucher.codeisempty")}function o(){s.voucherHasError=!1,s.voucherMessage=null}var s=this;s.id=t.id,s.config=e,s.userId=r.getUserId(),s.voucherMessage=null,s.voucherCode="",s.voucherHasError=!1,s.formVoucher=null,s.submitVoucher=i,s.logout=function(){a.logout()}}e.$inject=["configKiosk","$stateParams","voucherService","aqfAuthService","kioskAuthService"],angular.module("aqf.webkiosk.profile").controller("ProfileController",e)}(),function(){"use strict";function e(e){e.state("profile",{parent:"app",url:"/profile",data:{needLogin:!0},views:{"@app":{templateUrl:"app/views/profile/templates/profile.html",controller:"ProfileController",controllerAs:"profileController"}}})}e.$inject=["$stateProvider"],angular.module("aqf.webkiosk.profile").config(e)}(),function(){"use strict";angular.module("aqf.webkiosk.offlineLibrary",["aqf.app.offlineLibrary"])}(),function(){"use strict";function e(e,t,n,a){function r(){a.isOffline()?n.getOfflineAvailableIssues().then(function(e){o.offlineIssues=e,o.isLoading=!1},function(){o.isLoading=!1}):t.transitionTo("library",null,{reload:!0,notify:!0})}function i(n){t.go("read",{locale:e.locale,itemId:n})}var o=this;o.offlineIssues=[],o.isLoading=!0,o.init=r,o.readIssue=i,o.init()}e.$inject=["$stateParams","$state","aqfOfflineLibraryService","aqfKioskModeDetectorService"],angular.module("aqf.webkiosk.offlineLibrary").controller("OfflineLibraryController",e)}(),function(){"use strict";angular.module("aqf.webkiosk.offlineLibrary").config(["$stateProvider",function(e){e.state("offlineLibrary",{parent:"library",url:"/offline",views:{"@app":{templateUrl:"app/views/offlineLibrary/templates/offlineLibrary.html",controller:"OfflineLibraryController",controllerAs:"offlineLibraryController"}}})}])}(),function(){"use strict";angular.module("aqf.webkiosk.networkInfo",["aqf.ui.router"])}(),function(){"use strict";angular.module("aqf.webkiosk.networkInfo").controller("NetworkInfoController",["$scope","$state","$translate","$timeout","aqfKioskModeDetectorService","navigationService",function(e,t,n,a,r,i){function o(){e.$watch("online",function(e,t){e===t?c.show=!1:e?(c.show=!0,c.buttonText=n.instant("networkinfo.buttontextonline"),c.message=n.instant("networkinfo.messageonline")):e||(c.show=!0,c.buttonText=n.instant("networkinfo.buttontextoffline"),c.message=n.instant("networkinfo.messageoffline"))})}function s(){r.isDesktopMode()||(c.show=!c.show)}function l(){c.buttonText="Loading ...";var e=navigator.onLine?3e3:300;a(function(){c.show=!1,r.setOfflineMode(!navigator.onLine),i.toggleDisplayedItemsForOffline(navigator.onLine),navigator.onLine?t.transitionTo("library",null,{reload:!0,notify:!0}):t.transitionTo("offlineLibrary",null,{reload:!0,notify:!0})},e)}var c=this;c.show=!1,c.showBtn=r.isDesktopMode(),c.buttonText=n.instant("networkinfo.messageoffline"),c.message=n.instant("networkinfo.buttontextoffline"),c.toggleDisplayMessage=s,c.toggleOffline=l,c.init=o,o()}])}(),function(){"use strict";angular.module("aqf.webkiosk.libraryTitle",["aqf.app.analytics"])}(),function(){"use strict";function e(e,t,n,a,r,i,o){function s(){l();var t=[];t.push(m.getAcquiredIssues(n.titleId)),t.push(m.getTitle(n.titleId)),a.all(t).then(function(){m.isLoading=!1});var i=angular.element(r);i.bind("resize",function(){l(),e.$apply()})}function l(){m.elementWidth=r.innerWidth}function c(e){return i.getAcquiredIssuesOfTitle(e).then(function(e){m.acquiredIssues=e,_.each(m.acquiredIssues,function(e){e.linkParams=m.getLinkParams(e)})})}function u(e){return i.getTitle(e).then(function(e){m.title=e})}function f(e){p(m.title,e),t.go("read",{itemId:e})}function d(e){console.log("Details ("+e+") -- TO DO")}function g(e){return{state:"issue",params:{itemId:e.id}}}function p(e,t){var n=e.defaultName,a=_.findWhere(e.issues,{id:t}).defaultName;o.sendEventTrack("ks_read",{titleName:n,issueName:a}),o.sendEventTrack("Content Viewed",{titleName:n,issueName:a})}var m=this;m.acquiredIssues=[],m.title=null,m.isLoading=!0,m.elementHeight=250,m.elementWidth=0,m.thumbRatio=.75,m.tileHeight=200,m.init=s,m.getAcquiredIssues=c,m.getTitle=u,m.readIssue=f,m.viewIssueDetails=d,m.getLinkParams=g,s()}e.$inject=["$scope","$state","$stateParams","$q","$window","aqfLibraryService","aqfAppAnalyticsService"],angular.module("aqf.webkiosk.libraryTitle").controller("LibraryTitleController",e)}(),function(){"use strict";angular.module("aqf.webkiosk.libraryTitle").config(["$stateProvider",function(e){e.state("libraryTitle",{parent:"library",url:"/:titleId",date:{needLogin:!0},views:{"@app":{templateUrl:"app/views/libraryTitle/templates/libraryTitle.html",controller:"LibraryTitleController",controllerAs:"libraryTitleController"}}})}])}(),function(){"use strict";angular.module("aqf.webkiosk.library",["aqf.app.library","aqf.webkiosk.offlineLibrary","aqf.webkiosk.libraryTitle","aqf.app.analytics"])}(),function(){"use strict";function e(e,t,n,a,r){function i(){r.sendPageTrack("library"),a.isOffline()?e.go("offlineLibrary"):o()}function o(e,a){n.getTitlesOfAllAcquiredIssues(e,a).then(function(e){u.isLoading=!1;var t=Object.keys(e);1===t.length?s(e[t[0]]):u.titles=e},function(e){u.isLoading=!1,t.error("error",e)})}function s(t){e.go("libraryTitle",{titleId:t.id}),r.sendEventTrack("vl_title_click",{titleName:t.defaultName})}function l(e){var t,n;return _.isObject(e)&&_.isObject(e.metadata)&&_.isObject(e.metadata.physicalData)&&_.isObject(e.metadata.header)&&(t=e.metadata.physicalData.header.backgroundColor,n=e.metadata.physicalData.header.textColor),{background:t,color:n}}function c(){return 0===Object.keys(u.titles).length}var u=this;u.titles={},u.init=i,u.goToLibraryTitleView=s,u.getStyleForTitle=l,u.isLibraryEmpty=c,u.isLoading=!0,u.init()}e.$inject=["$state","$log","aqfLibraryService","aqfKioskModeDetectorService","aqfAppAnalyticsService"],angular.module("aqf.webkiosk.library").controller("LibraryController",e)}(),function(){"use strict";angular.module("aqf.webkiosk.library").config(["$stateProvider",function(e){e.state("library",{parent:"app",url:"/library",data:{needLogin:!0},views:{"@app":{templateUrl:"app/views/library/templates/library.html",controller:"LibraryController",controllerAs:"libraryController"}}})}])}(),function(){"use strict";angular.module("aqf.webkiosk.issue",["aqf.config","aqf.webkiosk.config","aqf.ui.router","aqf.i18n","aqf.kioskModeDetector","aqf.webSocket","aqf.webkiosk.config","aqf.auth","aqf.webkiosk.component.auth","aqf.app.issue","aqf.app.titles","aqf.utils.services","aqf.webkiosk.read","ui.bootstrap.tpls","ui.bootstrap.tabs","pascalprecht.translate","aqf.app.analytics"])}(),function(){"use strict";function e(e,t,n,a,r,i,o,s,l,c,u,f){function d(){o.isDesktopMode()||(I.readerStatus="ready"),i.getIssue(I.currentIssueId).then(function(t){o.isDesktopMode()&&(s.init(),k(t)),I.currentIssue=t,I.coverIds=t.resources.coverIds,I.thumbnailIds=t.resources.thumbnailIds,I.imagePreview=t.resources.previewIds,I.issueDescription=t.description,I.publicationDate=e("date")(new Date(t.publicationDate),"MMMM yyyy"),I.isLoading=!1,c.sendPageTrack("issue_"+I.currentIssue.titleName+"_"+I.currentIssue.defaultName)},function(e){console.error("error",e)})}function g(){y("ks_read"),t.go("read",{locale:n.locale,itemId:I.currentIssueId})}function p(){q=!0,y("ks_download"),I.readerStatus=null,s.send({action:"download",userId:I.userId,issueId:I.currentIssueId,name:I.currentIssue.name,url:I.currentIssue.getWebSource(o.isDesktopMode()).url,language:n.locale,coverUrl:i.getCoverUrl(I.currentIssue.resources.thumbnailIds),version:I.currentIssue.version})}function m(){i.isReadable(I.currentIssue,o.isDesktopMode())&&(o.isDesktopMode()&&"not-downloaded"===I.readerStatus?I.download():g())}function h(){var e=[];return i.isReadable(I.currentIssue,o.isDesktopMode())?e.push("btn-primary"):e.push("btn-danger"),e}function v(){if(!i.isReadable(I.currentIssue,o.isDesktopMode()))return a.instant("issue.errorButton");if(!o.isDesktopMode())return a.instant("issue.readButton");switch(I.readerStatus){case"downloading":return a.instant("issue.downloadingButton");case"not-downloaded":return a.instant("issue.downloadButton");case"ready":return a.instant("issue.readButton");case"error":return a.instant("issue.errorButton")}}function k(e){var t={};i.getReaderStatus(I.userId,I.currentIssueId,t,function(e){I.readerStatus=e.status,"downloading"===I.readerStatus&&b(),"error"===I.readerStatus&&q&&y("ks_download_fail",e.message||"Unknown error")})}function b(){i.getDownloadProgress(I.userId,I.currentIssueId,function(e){I.downloadPercentage=e.percentage,100===parseInt(I.downloadPercentage)&&y("ks_download_success")})}function y(e,t){u.get(I.currentIssue.titleBundleId,n.locale).then(function(n){var a={titleName:n.defaultName,issueName:I.currentIssue.defaultName,from:"detailView"};"ks_download_fail"===e&&(a.errorType=t),c.sendEventTrack(e,a),"ks_read"===e&&c.sendEventTrack("Content Viewed",a)})}var I=this;I.isLoading=!0,I.currentIssueId=n.itemId,I.viewportWidth=r.innerWidth,I.currentIssue={},I.thumbnailIds=[],I.coverIds=[],I.publicationDate="",I.imagePreview={},I.issueDescription={},I.isLoading=!0,I.userId=f.isLoggedIn()?l.getUserId():"public";var q=!1;I.readerStatus=null,I.tabs=[{heading:a.instant("issue.tab.information"),templateUrl:"app/views/issue/templates/preview1.html"}],I.init=d,I.read=g,I.download=p,I.getClassActionBtn=h,I.actionBtn=m,I.getTranslateActionBtn=v,I.init()}e.$inject=["$filter","$state","$stateParams","$translate","$window","aqfIssueService","aqfKioskModeDetectorService","aqfWebSocketService","kioskAuthService","aqfAppAnalyticsService","aqfTitleService","aqfAuthService"],angular.module("aqf.webkiosk.issue").controller("IssueController",e)}(),function(){angular.module("aqf.webkiosk.issue").config(["$stateProvider","configKiosk",function(e,t){e.state("issue",{parent:"app",url:"/issue/:itemId",data:{needLogin:t.authConfig.forceLogin},views:{"@app":{templateUrl:"app/views/issue/templates/issue.html",controller:"IssueController",controllerAs:"issueController"}}})}])}(),function(){"use strict";angular.module("aqf.webkiosk.home",["aqf.webkiosk.config","aqf.ui.router","aqf.storemodel","aqf-storemodel.tpl","aqf.storemodel.element.list","aqf-storemodel-element-list.tpl","aqf.storemodel.element.banner","aqf-storemodel-element-banner.tpl","aqf.storemodel.element.video","aqf-storemodel-element-video.tpl","aqf.storemodel.element.webview","aqf-storemodel-element-webview.tpl","aqf.storemodel.element.grid","aqf-storemodel-element-grid.tpl","aqf.storemodel.element.spotlight","aqf-storemodel-element-spotlight.tpl","aqf.storemodel.element.featured.item","aqf-storemodel-element-featured-item.tpl"])}(),function(){"use strict";angular.module("aqf.webkiosk.home").controller("HomeController",function(){})}(),angular.module("aqf.webkiosk.home").config(["$stateProvider","configKiosk",function(e,t){e.state("home",{parent:"app",url:"/",data:{needLogin:t.authConfig.forceLogin},views:{"@app":{templateUrl:"app/views/home/templates/home.html",controller:"HomeController",controllerAs:"homeController"}}})}]),function(){"use strict";angular.module("aqf.webkiosk.forgotPassword",["aqf.ui.router","pascalprecht.translate","aqf.app.user"])}(),function(){"use strict";function e(e,t){function n(){a.messages=[],a.form.$invalid?a.messages.push({type:"error",text:e.instant("signup.error.invalidform")}):t.forgotPassword(a.model).then(function(){a.messages.push({type:"msg",text:e.instant("forgotpassword.msgsuccess")})},function(t){a.messages.push({type:"error",text:e.instant("signup.error.wentwrong",{message:t.result.message})})})}var a=this;a.messages=[],a.form={},a.model={email:""},a.forgotPassword=n}e.$inject=["$translate","aqfUserService"],angular.module("aqf.webkiosk.forgotPassword").controller("ForgotPasswordController",e)}(),function(){angular.module("aqf.webkiosk.forgotPassword").config(["$stateProvider",function(e){e.state("forgotPassword",{parent:"main",url:":locale/forgot-password",data:{needLogin:!1},views:{"@main":{templateUrl:"app/views/forgot-password/templates/forgot-password.template.html",controller:"ForgotPasswordController",controllerAs:"forgotPasswordController"}}})}])}(),function(){"use strict";angular.module("aqf.webkiosk.app",["aqf.ui.router","aqf.auth","aqf.toolbar","aqf.toolbar.tpl","aqf.webkiosk.home","aqf.webkiosk.404","aqf.webkiosk.titles","aqf.webkiosk.issue","aqf.webkiosk.profile","aqf.webkiosk.category","aqf.webkiosk.storemodel","aqf.webkiosk.category","aqf.webkiosk.forgotPassword","aqf.webkiosk.search","aqf.webkiosk.signup","aqf.webkiosk.library","aqf.webkiosk.networkInfo","pascalprecht.translate","aqf.storemodel.component.link","aqf.webkiosk.categorySidebar","aqf.i18n","aqf.navigation"])}(),function(){"use strict";function e(e){e.state("main",{url:"/","abstract":!0,views:{"":{templateUrl:"app/views/content/templates/content.html"}},data:{needLogin:!1}})}e.$inject=["$stateProvider"],angular.module("aqf.webkiosk.app").config(e)}(),function(){"use strict";angular.module("aqf.webkiosk.categorySidebar",["aqf.navigation"])}(),function(){"use strict";function e(e,t,n,a,r){function i(){d.isLoaded=!1,e.$watch(function(){return a.isSidebarDisplay},function(e,t){!t&&e&&o()})}function o(){n.sendPageTrack("menu_category"),a.getMenu(t.params.locale).then(function(e){d.isLoaded=!0,d.data=e,_.map(d.data,function(e){e.images=_.pluck(e.category.headerImages,"id")})})}function s(){return d.isLoaded===!0?_.size(d.data)>1?r.instant("category-sidebar.Categories"):r.instant("category-sidebar.Category"):r.instant("category-sidebar.loading")}function l(){return d.isLoaded===!0?_.size(d.data):0}function c(e){return"issue"===e.category.typeContained?e.category.itemsCount>1?r.instant("category-sidebar.issues"):r.instant("category-sidebar.issue"):e.category.itemsCount>1?r.instant("category-sidebar.titles"):r.instant("category-sidebar.title")}function u(e){return e.category.itemsCount}function f(e){if(_.isObject(e)){var t=e.top>60?0:60-e.top;return{top:t}}}var d=this;d.service=a,d.isLoaded=!1,d.getTitleTranslate=s,d.getSize=l,d.getItemCountTranslate=c,d.getItemSize=u,d.getStyle=f,i()}e.$inject=["$scope","$state","aqfAppAnalyticsService","kioskCategoryService","$translate"],angular.module("aqf.webkiosk.categorySidebar").controller("CategorySidebarController",e)}(),function(){"use strict";angular.module("aqf.webkiosk.category",["aqf.app.category","aqf.storemodel.component.tile.title","aqf.storemodel.component.tile.issue"])}(),function(){"use strict";function e(e,t,n,a,r,i,o){function s(){l();var t=angular.element(n);t.bind("resize",function(){l(),e.$apply()}),i.get(c.id,"fr").then(function(e){c.category=e,c.category.metadata.physicalData&&c.category.metadata.physicalData.cover&&0!==c.category.metadata.physicalData.cover.height&&(c.thumbnailRatio=c.category.metadata.physicalData.cover.width/c.category.metadata.physicalData.cover.height),_.each(c.category.headerImages,function(e){c.coverIds.push(e.id)}),i.getContent(c.id,c.category.typeContained).then(function(e){c.categoryContent=e,_.each(c.categoryContent,function(e){"title"===c.category.typeContained&&(e.linkParams={state:"title",params:{itemId:e.id}}),"issue"===c.category.typeContained&&(e.linkParams={state:"issue",params:{itemId:e.id}})}),c.isLoading=!1},function(e){a.error(e)}),o.sendPageTrack("category_"+c.category.defaultName)},function(e){a.error(e)})}function l(){c.coverImageWidth=n.innerWidth,c.coverImageHeight=250}var c=this;c.id=t.itemId,c.isLoading=!0,c.config=r,c.coverIds=[],c.coverImageWidth=0,c.coverImageHeight=250,c.tileHeight=250,c.init=s,c.init=s,c.init()}e.$inject=["$scope","$stateParams","$window","$log","configKiosk","kioskCategoryService","aqfAppAnalyticsService"],angular.module("aqf.webkiosk.category").controller("CategoryController",e)}(),function(){angular.module("aqf.webkiosk.category").config(["$stateProvider","configKiosk",function(e,t){e.state("category",{parent:"app",url:"/category/:itemId",data:{needLogin:t.authConfig.forceLogin},views:{"@app":{templateUrl:"app/views/category/templates/category.html",controller:"CategoryController",controllerAs:"categoryController"}}})}])}(),function(){"use strict";angular.module("aqf.webkiosk.app.services",["aqf.auth","aqf.webkiosk.component.auth","aqf.toolbar","aqf.toolbar.tpl","pascalprecht.translate","aqf.storemodel.component.link"])}(),function(){"use strict";function e(e,t,n,a){a.init();var r=_.clone(t.brand);e.initToolbar(r),e.addToolbar(r,"brand");var i=_.clone(t.right);i.contents=a.initTools(n.navigation.right,i.contents),e.initToolbar(i),e.addToolbar(i,"right");var o={isDisplay:!0,cssClass:"toolbar-center",contents:_.clone(n.navigation.item)};a.initNavBar(o),e.initToolbar(o),e.addToolbar(o,"center");var s=_.clone(t.language),l=_.clone(n.language.availableLocales);a.initLanguage(s,l),e.initToolbar(s),e.addToolbar(s,"right-language"),a.initLogo(n.meta.logo);var c=_.clone(t.connection);e.initToolbar(c),e.addToolbar(c,"right-connection")}e.$inject=["aqfToolbarService","kioskToolbar","configKiosk","navigationService"],angular.module("aqf.webkiosk.app").run(e)}(),function(){"use strict";function e(e){var t=this;t.navigationValue=e}e.$inject=["navigationValue"],angular.module("aqf.webkiosk.app").controller("HeaderController",e)}(),function(){var e=window.configKiosk||{};angular.module("aqf.webkiosk.config",[]).constant("configKiosk",e)}(),function(){"use strict";var e={brand:{isDisplay:!0,cssClass:"toolbar-brand",contents:[{name:"bars",type:"link",cssClass:"nav-btn",icon:"fa fa-bars",isDisplay:!0,service:"navigationService",config:"configNavbarButton"},{name:"ellipsis",type:"link",cssClass:"action-btn",icon:"fa fa-ellipsis-v",isDisplay:!0,service:"navigationService",config:"configNavbarButton"},{name:"logo",type:"link",isDisplay:!0,cssClass:"logo",service:"navigationService",config:"configNavbarButton"}]},center:{isDisplay:!0,cssClass:"toolbar-center"
},right:{isDisplay:!0,cssClass:"toolbar-right",contents:[{name:"search",type:"link",cssClass:"btn-link aqf-md-bg-round-from-center",icon:"icon-search",isDisplay:!0,service:"navigationService",config:"configNavbarButton"},{name:"category",type:"link",cssClass:"btn-link aqf-md-bg-round-from-center",icon:"icon-categories",isDisplay:!0,service:"navigationService",config:"configNavbarButton"},{name:"language",type:"link",cssClass:"btn-link aqf-md-bg-round-from-center",icon:"icon-languages",isDisplay:!0,service:"navigationService",config:"configNavbarButton"},{name:"connection",label:"Connect",type:"link",cssClass:"btn-link btn-connect",icon:"icon-profile",isDisplay:!0,service:"navigationService",config:"configNavbarButton"}]},language:{isDisplay:!0,cssClass:"toolbar-language",contents:[]},connection:{isDisplay:!0,cssClass:"toolbar-connection",contents:[{name:"profile",type:"link",cssClass:"btn-link aqf-underline-from-center",icon:"icon-profile",isDisplay:!0,service:"navigationService",config:"configNavbarButton"},{name:"logout",type:"link",cssClass:"btn-link aqf-underline-from-center",icon:"fa fa-sign-out",isDisplay:!0,service:"navigationService",config:"configNavbarButton"}]}};angular.module("aqf.webkiosk.config").constant("kioskToolbar",e)}(),function(){"use strict";function e(e,t,n){t.addResolve("auth",["aqfAuthService","aqfStateCurrent","$q",function(e,t,n){var a=t.state,r=n.defer(),i=!_.isUndefined(a.data)&&!_.isUndefined(a.data.needLogin)&&a.data.needLogin;return e.setNeedLogin(i),e.checkForActiveSession().then(function(){e.setIsLoggedIn(!0),r.resolve()},function(){e.setIsLoggedIn(!1),i?r.reject("not connected"):r.resolve()}),r.promise}]),t.addResolve("i18n",["aqfI18nService","$stateParams","aqfStateCurrent",function(e,t,n){return n.state.url.source.indexOf("locale")===-1||e.getResolveFn(t.locale)}]),e.state("app",{url:":locale",parent:"main",redirectTo:"defaultHome",views:{"":{templateUrl:"app/views/app/templates/app.html"},header:{templateUrl:"app/views/app/templates/header.html",controller:"HeaderController",controllerAs:"headerController"},"network-info":{templateUrl:"app/views/networkInfo/templates/networkInfo.html",controller:"NetworkInfoController",controllerAs:"networkInfoController"},search:{templateUrl:"app/views/search/templates/search.html",controller:"SearchController",controllerAs:"searchController"},"category-sidebar":{templateUrl:"app/views/categorySidebar/templates/categorySidebar.html",controller:"CategorySidebarController",controllerAs:"categorySidebarController"}},data:{needLogin:n.authConfig.forceLogin}})}e.$inject=["$stateProvider","aqfStateServiceProvider","configKiosk"],angular.module("aqf.webkiosk.app").config(e)}(),function(){"use strict";angular.module("aqf.webkiosk.404",[])}(),angular.module("aqf.webkiosk.404").config(["$stateProvider",function(e){e.state("404",{parent:"app",url:"/404",views:{"@app":{templateUrl:"app/views/404/404.html"}}})}]),angular.module("aqf.app.voucher",["ngResource","pascalprecht.translate"]),function(){"use strict";function e(e,t){function n(n){var a=e.defer();return t.redeem({code:n}).then(function(){a.resolve()},function(e){a.reject(e)}),a.promise}var a={addVoucher:n};return a}e.$inject=["$q","voucherApiService"],angular.module("aqf.app.voucher").factory("voucherService",e)}(),angular.module("aqf.app.voucher").factory("VoucherResource",["$resource",function(e){return e("api/:pattern/:service",{pattern:"voucher"},{redeem:{method:"POST",params:{service:"redeem"},data:{code:""}}})}]),function(){"use strict";function e(e,t,n){function a(a){var r=e.defer();if(_.isUndefined(a))r.reject(n["001"]);else{var i={code:a.code};t.redeem({},i,function(e){e&&e.result&&e.result.status&&"0"===e.result.status?r.resolve(e):r.reject(_.isUndefined(n[e.result.status])?n[602]:n[e.result.status])},function(){r.reject(n[602])})}return r.promise}var r={redeem:a};return r}e.$inject=["$q","VoucherResource","voucherErrorCodes"],angular.module("aqf.app.voucher").factory("voucherApiService",e)}(),function(){"use strict";angular.module("aqf.app.voucher").constant("voucherErrorCodes",{703:"voucher.error.codeExpired",702:"voucher.error.codeActivationLimitReached",605:"voucher.error.codeBadFormat",602:"voucher.error.codeNotFound",601:"voucher.error.codeAlreadyUsed","001":"voucher.error.noCode"})}(),function(){"use strict";angular.module("aqf.app.user",["ngResource"])}(),function(){"use strict";function e(e,t){function n(n){var a=e.defer();return _.isUndefined(n.email)&&_.isUndefined(n.password)?a.reject():t.create({},n,function(e){e&&e.result&&e.result.status&&"0"===e.result.status?a.resolve(e.result):a.reject(e)},function(e){a.reject(e)}),a.promise}function a(n){var a=e.defer();return _.isUndefined(n.email)?a.reject():t.forgotPassword({},n,function(e){e&&e.result&&e.result.status&&"0"===e.result.status?a.resolve(e.result):a.reject(e)},function(e){a.reject(e)}),a.promise}var r={signup:n,forgotPassword:a};return r}e.$inject=["$q","AqfUserResource"],angular.module("aqf.app.user").service("aqfUserService",e)}(),function(){"use strict";angular.module("aqf.app.user").factory("AqfUserResource",["$resource",function(e){return e("api/:pattern/:service",{},{create:{method:"POST",params:{pattern:"account",service:"create"},data:{email:"",password:""}},forgotPassword:{method:"POST",params:{pattern:"account",service:"forgotPassword"},data:{email:""}}})}])}(),function(){"use strict";angular.module("aqf.app.titles",["ngResource"])}(),function(){"use strict";function e(e,t,n){function a(a,r){var i=e.defer(),o={titleId:a,locale:r};return t.get(o,{},function(e){if(e&&e.data&&e.data.title&&"0"===e.result.status){var t=new n(e.data.title);i.resolve(t)}else i.reject(e)},function(e){i.reject(e)}),i.promise}function r(a){var r=e.defer(),i={locale:a,filters:{titlesSubscribedOnly:!1}};return t.getAll({},i,function(e){if(e&&e.data&&"0"===e.result.status){var t=[];_.each(e.data.titles,function(e){var a=new n(e.title);t.push(a)}),r.resolve(t)}else r.reject(e)},function(e){r.reject(e)}),r.promise}var i={get:a,getAll:r};return i}e.$inject=["$q","aqfTitleResource","TitleModel"],angular.module("aqf.app.titles").factory("aqfTitleService",e)}(),function(){"use strict";angular.module("aqf.app.titles").factory("aqfTitleResource",["$resource",function(e){return e("api/:pattern/:service",{},{get:{method:"GET",params:{pattern:"title",service:"get"},data:{token:"",titleId:"",locale:""}},getAll:{method:"POST",params:{pattern:"title",service:"getAll"},data:{token:"",filters:{titlesSubscribedOnly:!1}}}})}])}(),function(){"use strict";function e(){function e(){return n.config}var t={getConfig:e};return t}function t(){var t=this;t.setConfig=function(e){n.config=e},t.$get=e}angular.module("aqf.app.titles").provider("aqfTitleConfigService",t);var n={}}(),function(){"use strict";angular.module("aqf.app.titles").factory("TitleModel",["aqfTitleConfigService",function(e){var t=function(e){this.creationDate="",this.description="",this.id="",this.languageCode="",this.metadata={},this.name="",this.periodicity="",this.type="",this.version="",this.coverUrl="",this.issues=[],this.categories=[],this.products=[],angular.isDefined(e)&&this.parse(e)};return t.prototype.parse=function(e){if(e){var t=this;angular.forEach(e,function(e,n){t[n]=e})}},t.prototype.getCoverUrl=function(t,n){if(this.id){var a={width:t,height:n},r=e.getConfig(),i=r.app.access.mediaUrl;return i=i.replace(":titleId",this.id),angular.forEach(a,function(e,t){i+=t+"="+e+"&"}),i}return""},t}])}(),function(){"use strict";angular.module("aqf.app.search",["ngResource","aqf.i18n","aqf.app.titles","aqf.app.issue","aqf.app.analytics","aqf.kioskModeDetector","aqf.app.reader","LocalStorageModule"])}(),function(){"use strict";function e(){var e=this;e.setConfig=function(e){n=e},e.$get=t}function t(e,t,a,r,i){function o(n,a){var r=e.defer(),i=a&&a.where?a.where:"issues",o={query:n,where:i};return a&&a.from&&(o.from=a.from),a&&a.size&&(o.size=a.size),a&&a.issueId&&(o.issue_id=a.issueId),a&&a.zaveId&&(o.zave_id=a.zaveId),a&&a.readerId&&(o.reader_id=a.readerId),!a||!a.where||"pages"!==a.where||a.issueId&&a.zaveId&&a.readerId?t.search({where:o.where},o,function(e){e[i]&&e[i].total>0?r.resolve(e[i]):r.reject("error.noresult")},function(e){r.reject(e)}):r.reject("error.missingParameters"),r.promise}function s(){m.isDisplay=!m.isDisplay,m.isDisplay&&r.sendPageTrack("search")}function l(e){e.click=m.toggleSearch,e.label=m.labelSearch}function c(){return a.instant("search.label")}function u(e){if(!_.isEmpty(e)){var t=i.get(p)||[];t.length>=g&&t.shift(),t.push({token:e,date:new Date}),t=f(t,e),i.set(p,t)}}function f(e,t){for(var n=[],a=e.length;a--;)e[a].token===t&&(n.push(t),n.length>1&&e.splice(a,1));return e}function d(){return i.get(p)||[]}var g=100,p="searchHistory."+(_.isEmpty(n)?"":n.app.applicationDetails.bundleId),m={currentElement:void 0,isDisplay:!1,deepSearch:o,config:l,toggleSearch:s,labelSearch:c,saveSearchInSearchHistory:u,getSearchHistory:d};return m}t.$inject=["$q","AqfDeepSearchResource","$translate","aqfAppAnalyticsService","localStorageService"],angular.module("aqf.app.search").provider("kioskSearchService",e);var n={}}(),function(){angular.module("aqf.app.search").factory("AqfSearchResource",["$resource",function(e){return e("api/:pattern/:service",{},{search:{method:"POST",params:{pattern:"search"},data:{token:"",entities:"",tokens:""}}})}])}(),function(){angular.module("aqf.app.search").factory("AqfDeepSearchResource",["$resource",function(e){return e("search/:where/content",{},{search:{method:"POST",params:{},data:{token:"",where:"issues"}}})}])}(),function(){"use strict";angular.module("aqf.app.reader",["aqua.porthole","aqf.webkiosk.cache","aqf.webkiosk.component.auth"])}(),function(){"use strict";function e(e,t,n,a,r,i,o){function s(){l();var n=angular.element("<iframe></iframe>");n.attr("id",y.readerId),n.attr("name",y.readerName),n.attr("src",t.trustAsResourceUrl(y.iframeUrl)),n.attr("width","100%"),n.attr("height","100%"),n.attr("allowfullscreen",!0),n.attr("frameborder","0"),y.iframe=n,e.html(y.iframe)}function l(){y.readerProxyInstance=o.createInstanceCommunicateFrame(y.iframeUrl,y.readerName),y.readerProxyInstance.addEventListener(c)}function c(e){_.isFunction(b[e.data.eventName])?b[e.data.eventName](e):a.error("eventName have not listener")}function u(e){var t=e.data.indexPage;y.onGoToPage({indexPage:t})}function f(){y.readerProxyInstance.removeEventListener(c),y.readerProxyInstance=null}function d(){n.$apply(function(){y.onExit({readerId:y.readerId})})}function g(){n.$apply(function(){var e={};y.options&&y.options.locationType?(e.eventName="kiosk_goToLocation",e.locationType=y.options.locationType,e.location=y.options.location):(e.eventName="kiosk_goToPage",e.indexPage=y.indexPage),y.readerProxyInstance.post(e),_.isNull(y.annotationsInfo)||(e={eventName:"kiosk_annotationsInfo",info:y.annotationsInfo},y.readerProxyInstance.post(e)),_.isNull(y.analyticsInfo)||(e={eventName:"kiosk_analyticsInfo",info:y.analyticsInfo},y.readerProxyInstance.post(e)),y.onReaderReady({ready:!0,readerId:y.readerId})})}function p(){y.onFirebaseReauth({callback:function(e){y.annotationsInfo.token=e;var t={eventName:"kiosk_newFirebaseToken",info:y.annotationsInfo};y.readerProxyInstance.post(t)}})}function m(){var e={eventName:"printAndDownloadInfo",url:"",downloadable:!1,printable:!1};_.isObject(y.readerIssue.metadata.exportableContent)&&(e.url=y.readerIssue.metadata.exportableContent.url,e.downloadable=y.readerIssue.metadata.exportableContent.downloadable,e.printable=y.readerIssue.metadata.exportableContent.printable),y.readerProxyInstance.post(e)}function h(){var e=i.getUserId(),t={eventName:"kiosk_user",mbox:e,name:e};y.readerProxyInstance.post(t)}function v(){if(r.userInfo.applicationSettings&&r.userInfo.applicationSettings.metadata){var e=angular.fromJson(r.userInfo.applicationSettings.metadata);if(e["tincan-lrs"]&&e["tincan-lrs"].endpoint){var t=e["tincan-lrs"],n={eventName:"kiosk_tincan_infos"};n.enabled=!0,n.eventName="kiosk_tincan_infos",n.endpoint=t.endpoint,n["lrs-user"]=t.username,n["lrs-password"]=t.password,y.readerProxyInstance.post(n)}}}function k(){var e="";return e=_.isEmpty(y.readerUrl)?y.readerIssue.webSourceUrl:y.readerUrl,e+"?kioskDomain="+y.domain+"#?kioskDomain="+y.domain}var b={reader_exit:d,reader_loaded:g,reader_firebaseReAuth:p,getPrintAndDownloadInfo:m,reader_goToPage:u,get_user:h,get_tincan_infos:v},y=this;y.iframeUrl=k(),y.readerProxyInstance=null,y.iframe=null,y.$onInit=s,y.$onDestroy=f,y.onMessage=c}e.$inject=["$element","$sce","$scope","$log","kioskAuthValue","kioskAuthService","windowProxyService"],angular.module("aqf.app.reader").component("aqfReader",{bindings:{readerId:"<",readerName:"<",readerIssue:"<",readerUrl:"<",domain:"<",onReaderReady:"&",onExit:"&",indexPage:"<",onGoToPage:"&",annotationsInfo:"<?",onFirebaseReauth:"&?",analyticsInfo:"<?",options:"<"},restrict:"E",template:'<div ng-if="readerComponentController.loading" >Loading...</div>',controller:e,controllerAs:"readerComponentController"})}(),function(){"use strict";angular.module("aqf.app.offlineLibrary",["ngResource","aqf.webkiosk.component.auth"])}(),function(){"use strict";function e(e,t,n){function a(){var a=e.defer();return t.getOfflineIssues({userId:n.getUserId()},{},function(e){e&&e.data&&e.data.issues?a.resolve(e.data.issues):a.reject()},function(){a.reject()}),a.promise}var r={getOfflineAvailableIssues:a};return r}e.$inject=["$q","aqfOfflineLibraryResource","kioskAuthService"],angular.module("aqf.app.offlineLibrary").service("aqfOfflineLibraryService",e)}(),function(){"use strict";angular.module("aqf.app.offlineLibrary").factory("aqfOfflineLibraryResource",["$resource",function(e){return e("offline/:pattern/:service",{},{getOfflineIssues:{method:"GET",params:{pattern:"issue",service:"getOfflineIssues"},data:{token:"",userId:""}}})}])}(),function(){"use strict";angular.module("aqf.navigation",["aqf.config","aqf.webkiosk.config","aqf.ui.router","aqf.auth","aqf.webkiosk.component.auth","aqf.i18n","pascalprecht.translate","aqf.toolbar","aqf.toolbar.tpl","aqf.storemodel.component.link","aqf.app.search","aqf.app.category","aqf.app.analytics","aqf.kioskModeDetector"])}(),function(){"use strict";angular.module("aqf.navigation").value("navigationValue",{logo:null,displayBars:!1,displayEllipsis:!1,displayLanguage:!1,displayConnection:!1})}(),function(){"use strict";function e(e,t,n,a,r,i,o,s,l,c,u,f,d,g){function p(){e.$on("$stateChangeSuccess",function(){x.clean()})}function m(e){switch(e.name){case"bars":e.click=x.toggleBars;break;case"ellipsis":e.click=x.toggleEllipsis;break;case"logo":e.buildHref=x.buildHrefHome,e.label=x.getLogo;break;case"search":e.click=x.toggleSidebarSearch,e.label=x.getTraduction("navigation.tools.search");break;case"language":e.click=x.toggleLanguage,e.label=x.getTraduction("navigation.tools.language");break;case"category":e.click=x.toggleSidebarCategory,e.label=x.getTraduction("navigation.tools.category");break;case"connection":e.click=x.onClickLoginlogout,e.label=x.getLabelConnection;break;case"profile":e.click=x.onClickProfile,e.label=x.getTraduction("navigation.tools.profile");break;case"logout":e.click=x.closeAndGo(r.logout,r),e.label=x.getTraduction("navigation.tools.disconnect")}return e}function h(e,t){var n=[];return _.each(e,function(e){var a=_.findWhere(t,{name:e});n.push(a)}),n}function v(e){o.logo=e}function k(e){_.map(e.contents,function(e){e.label=x.getTraduction(e.translate),e.type="link",e.isDisplay=e.enabled,e.cssClass=x.getClassNavigation,e.buildHref=x.buildHref})}function b(e,t){e.contents=[],_.each(t,function(t){var n={};n.locale=t,n.label=x.getTraduction("navigation.language."+t),n.cssClass=x.getClassLanguage,n.type="link",n.isDisplay=!0,n.buildHref=x.buildHrefLocale,n.click=function(){return y(t)},e.contents.push(n)})}function y(e){e!==n.locale&&g.sendEventTrack("ks_language_switch",{language:e})}function I(e){return _.isString(e.url)&&!_.isEmpty(e.url)?e.url:c.buildHref({state:e.key,params:{locale:n.locale}})}function q(e){return c.buildHref({state:".",params:{locale:e.locale}})}function w(e){var n=[];return n.push("locale-"+e.locale),t.params.locale===e.locale&&n.push("active"),n.push("aqf-underline-from-center"),n}function S(e){var n=[];return n.push("views-"+e.key),t.includes(e.key)&&n.push("active"),n.push("aqf-underline-from-center"),n}function C(){x.clean(),t.go("profile")}function $(){if(g.sendPageTrack("account"),r.isLoggedIn()){var e=o.displayConnection;x.clean(),o.displayConnection=!e}else r.setNeedLogin(!0)}function T(){return r.isLoggedIn()===!0?l.getUserId():a.instant("navigation.tools.connect")}function A(){o.displayBars=!1,o.displayEllipsis=!1,o.displayLanguage=!1,o.displayConnection=!1,i.isDisplay=!1,s.isSidebarDisplay=!1}function L(){var e=o.displayBars;x.clean(),o.displayBars=!e}function D(){var e=o.displayEllipsis;x.clean(),o.displayEllipsis=!e}function P(){var e=s.isSidebarDisplay;x.clean(),s.isSidebarDisplay=!e}function j(){var e=i.isDisplay;x.clean(),i.isDisplay=!e}function M(){var e=o.displayLanguage;x.clean(),o.displayLanguage=!e}function O(){var e=a.instant("navigation.altLogo"),t=o.logo;if(t)return'<img src="'+t+'" alt="'+e+'" title="'+e+'"/>'}function R(){var e="";return e=d.isOffline()?"library":f.navigation.item[0].key,c.buildHref({state:e})}function U(e){return function(){return a.instant(e)}}function N(e,t){return function(){return x.clean(),e.apply(t)}}function E(e){var t=_.findWhere(u.right.contents,{name:"search"});t&&(t.isDisplay=e),t=_.findWhere(u.right.contents,{name:"category"}),t&&(t.isDisplay=e),t=_.findWhere(u.connection.contents,{name:"logout"}),t&&(t.isDisplay=e),t=_.findWhere(f.navigation.item,{key:"home"}),t&&(t.isDisplay=e),t=_.findWhere(f.navigation.item,{key:"titles"}),t&&(t.isDisplay=e)}var x={init:p,clean:A,initTools:h,initLogo:v,initNavBar:k,initLanguage:b,getClassLanguage:w,getClassNavigation:S,getLabelConnection:T,buildHref:I,buildHrefLocale:q,configNavbarButton:m,onClickLoginlogout:$,onClickProfile:C,toggleBars:L,toggleEllipsis:D,toggleLanguage:M,toggleSidebarCategory:P,toggleSidebarSearch:j,closeAndGo:N,getTraduction:U,getLogo:O,buildHrefHome:R,toggleDisplayedItemsForOffline:E};return x}e.$inject=["$rootScope","$state","$stateParams","$translate","aqfAuthService","kioskSearchService","navigationValue","kioskCategoryService","kioskAuthService","StoreModelComponentLinkService","kioskToolbar","configKiosk","aqfKioskModeDetectorService","aqfAppAnalyticsService"],angular.module("aqf.navigation").factory("navigationService",e)}(),function(){"use strict";angular.module("aqf.app.library",["aqf.i18n","aqf.webkiosk.config","aqf.app.titles","aqf.app.issue"])}(),function(){"use strict";function e(e,t,a,r,i){function o(e){v=e}function s(e){_.each(e,function(e){b[e.id]||(b[e.id]=e)})}function l(e){b[e.id]=e}function c(e){delete b[e.id]}function u(t){var n;return n=e.defer(),v?n.resolve(p(t,v)):a.getAllAcquired().then(function(e){e&&e.issues&&e.issues.length>0?n.resolve(p(t,e.issues)):n.reject(e)},function(e){n.reject(e)}),n.promise}function f(t){var n;return n=e.defer(),b[t]?n.resolve(b[t]):k.getTitlesOfAllAcquiredIssues().then(function(){b[t]?n.resolve(b[t]):n.reject("ERROR: "+t+" not found!")}),n.promise}function d(a,o){var s,l,c,u;return s=e.defer(),c=[],u=[],b={},k.listTitleBundleIdsOfAllAcquiredIssues(a,o).then(function(a){var o=t.params.locale;o||(o=n.config.language.locale),_.each(a,function(e){l=r.get(e,o).then(function(e){k.addTitleOfAllAcquiredIssues(e)},function(){i.error("user has not acces to titleBundleId "+e)}),c.push(l)}),u=e.all(c)["finally"](function(){b=h(b,v),s.resolve(b)})}),s.promise}function g(t,n){var r;return r=e.defer(),a.getAllAcquired(t,n).then(function(e){e&&e.issues&&e.issues.length>0?(k.setAcquiredIssues(e.issues),r.resolve(m(e.issues))):r.reject(e)},function(e){r.reject(e)}),r.promise}function p(e,t){var n=[];return _.each(t,function(t){t.titleBundleId===e&&n.push(t)}),n}function m(e){var t,n;return n=[],_.each(e,function(e){t=e.titleBundleId,n.indexOf(t)===-1&&n.push(t)}),n}function h(e,t){return _.each(e,function(e){_.each(t,function(t){t.titleBundleId===e.id&&e.issues.push(t)})}),e}var v,k={setAcquiredIssues:o,setTitlesOfAllAcquiredIssues:s,addTitleOfAllAcquiredIssues:l,removeTitleOfAllAcquiredIssues:c,getAcquiredIssuesOfTitle:u,getTitle:f,getTitlesOfAllAcquiredIssues:d,listTitleBundleIdsOfAllAcquiredIssues:g},b={};return k}function t(){var t=this;t.setConfig=function(e){n.config=e},t.$get=e}e.$inject=["$q","$state","aqfIssueService","aqfTitleService","$log"],angular.module("aqf.app.library").provider("aqfLibraryService",t);var n={}}(),function(){"use strict";angular.module("aqf.app.issue",["ngResource","aqf.utils.services","aqf.webSocket","aqf.config","aqf.webkiosk.config"])}(),function(){"use strict";function e(e,t,n,a,r,i,o){function s(t){var a=e.defer(),r={issueId:t.id,receipt:""};return n.addIssue(r,{},function(e){e&&e.data&&"0"===e.result.status?a.resolve(e):a.reject(e)},function(e){a.reject(e)}),a.promise}function l(r){var i=e.defer(),o={filter:"",titleId:r,limit:1e3,offset:0};return n.getAll(o,{},function(e){if(e&&e.data&&e.data.issues){var n=[];angular.forEach(e.data.issues,function(e){var t=new a(e.issue);n.push(t)}),i.resolve(n)}else t.error("Cannot find any issues for title : "+r),i.reject()},function(e){i.reject(e)}),i.promise}function c(t,r){var i=e.defer(),o={limit:r,offset:t};return n.getAllAcquired(o,{},function(e){if(e&&e.data&&e.data.issues&&e.data.issues.length>0){var t=[];angular.forEach(e.data.issues,function(e){if(!e.issue.metadata||!e.issue.metadata.is_child||"1"!==e.issue.metadata.is_child){var n=new a(e.issue);t.push(n)}});var n=e.data.hasOwnProperty("moreToLoad")&&e.data.moreToLoad===!0;i.resolve({issues:t,moreToLoad:n})}else i.reject(e)},function(e){i.reject(e)}),i.promise}function u(t){var r=e.defer(),i={issueId:t};return n.getIssue(i,{},function(e){if(e&&e.data&&e.data.issue){var t=new a(e.data.issue);r.resolve(t)}else r.reject(e)},function(e){r.reject(e)}),r.promise}function f(t,i){var o=e.defer(),s={titleId:t};if(i){var l=r.getDateWithMaxTime(i);s.fromDate=Math.round(l.getTime()/1e3).toString()}return n.getLatest(s,{},function(e){if(e&&e.data&&e.data.issues){var t;e.data.issues.length>0&&(t=new a(e.data.issues[0].issue)),o.resolve(t)}else o.reject(void 0)},function(e){o.reject(e)}),o.promise}function d(t,r){var i=e.defer(),o={query:angular.toJson(b(t,r))};return n.getLatestIssues(o,{},function(e){if(e&&e.data&&"0"===e.result.status){var t=[];angular.forEach(e.data,function(e){angular.forEach(e.issues,function(e){var n=new a(e.issue);t.push(n)})}),i.resolve(t)}},function(e){i.reject(e)}),i.promise}function g(t,a){var r=e.defer(),i={issueId:t,sourceId:a};return n.getWebSourceById(i,{},function(e){if(e&&e.result&&"0"===e.result.status){var t=e.data.url,n=/^https?:\/\/.*\.html$/.exec(t);null===n&&(t+="index.html"),r.resolve(t)}else r.reject(e)}),r.promise}function p(n){var a=e.defer();if(n.webSourceUrl&&""!==n.webSourceUrl)a.resolve(n);else{var r=n.getWebSource();if(r){var i=[];n.acquired||""!==n.sku||i.push(I.addIssue(n)),e.all(i).then(function(){I.getWebSourceById(n.id,r.id).then(function(e){n.webSourceUrl=e,a.resolve(n)},function(e){n.webSourceError=!0,t.error(e),a.reject(e)})})}else t.error("No web source"),a.reject("No web source")}return a.promise}function m(e,t,n,a){i.onMessage(function(n){var r=JSON.parse(n.data),i={message:r.message};if("onReaderStatus"===r.action&&r.userId===e&&r.issueId===t)return r.hasError?"versionmismatch"===r.message?(i.status="versionmismatch",i.url=r.readerUrl):i.status="error":r.isDownloading?i.status="downloading":r.isDownloaded?(i.status="ready",i.url=r.readerUrl):i.status="not-downloaded",a(i)}),i.send(_.extend({action:"readerStatus",userId:e,issueId:t},n))}function h(e,t,n){i.onMessage(function(a){var r=JSON.parse(a.data);"onDownloadProgress"===r.action&&r.userId===e&&r.issueId===t&&n(r)})}function v(e){var t="",n=o.getConfig().offline.thumbnail.width,a=o.getConfig().offline.thumbnail.height;if(_.isEmpty(e))return"";var r=o.getConfig().app.access.kyashuUrl;return _.isEmpty(r)?"":(_.each(e,function(e){t+=""===t?e:";"+e}),r+"&ids="+t+"&width="+n+"&height="+a)}function k(e,t){var n=e.getWebSource(t);return _.isObject(n)&&_.isString(n.url)&&!_.isEmpty(n.url)}function b(e,t){var n=[];return _.each(e,function(e){n.push(y(e.id,t))}),n}function y(e,t){return t=t||{},_.extend({titleIdentifier:e,order:"DESC",filter:"ALL",start:0,limit:1},t)}var I={addIssue:s,getAll:l,getIssue:u,getLatest:f,getLatestIssues:d,getAllAcquired:c,getWebSourceById:g,readIssue:p,getReaderStatus:m,getDownloadProgress:h,getCoverUrl:v,isReadable:k};return I}e.$inject=["$q","$log","aqfIssueResource","AqfIssueModel","DateUtils","aqfWebSocketService","aqfConfigService"],angular.module("aqf.app.issue").service("aqfIssueService",e)}(),function(){"use strict";angular.module("aqf.app.issue").factory("aqfIssueResource",["$resource",function(e){return e("api/:pattern/:service",{},{addIssue:{method:"POST",params:{pattern:"issue",service:"add"},data:{issueId:"",receipt:""}},getIssue:{method:"GET",params:{pattern:"issue",service:"get"},data:{token:"",issueId:""}},getLatest:{method:"POST",params:{pattern:"issue",service:"getLatest"},data:{token:"",titleId:""}},getLatestIssues:{method:"POST",params:{pattern:"issue",service:"getWithSimpleQuery"}},getAll:{method:"POST",params:{pattern:"issue",service:"getAll"},data:{token:"",filter:"",titleId:""}},getAllAcquired:{method:"GET",params:{pattern:"issue",service:"getAllAcquired"},data:{token:""}},getWebSourceById:{method:"GET",params:{pattern:"issue",service:"getWebSourceById",issueId:"",sourceId:""}}})}])}(),function(){"use strict";function e(){var e=function(e){this.acquirableViaSubsciption=!1,this.acquired=!1,this.availability="",this.description="",this.hasSummary=!1,this.headlines=[],this.id="",this.inAppLibrary=!1,this.metadata={},this.name="",this.number="",this.publicationDate="",this.sku="",this.test=!1,this.titleBundleId="",this.titleId="",this.typeId="",this.version="",this.extra=!1,this.resources=[],this.webSources=[],this.webSourceUrl="",this.webSourceError=!1,this.coverUrl="",this.title=void 0,this.downloaded=!1,this.distantIsReachable=!0,angular.isDefined(e)&&this.parse(e)};return e.prototype.parse=function(e){if(e){var t=this;angular.forEach(e,function(e,n){t[n]=e}),t.coverUrl=t.getMediaUrl("cover",400,400),t.publicationDate=new Date(parseInt(1e3*t.publicationDate)).toISOString(),t._parseHtmlDescription()}},e.prototype.getMediaUrl=function(e,t,n){if(e&&this.resources&&this.resources[e+"Id"]){var a=this.resources[e+"Id"],r={width:t,height:n,id:a},i="TODO";return angular.forEach(r,function(e,t){i+=t+"="+e+"&"}),i}},e.prototype.getPreviews=function(e,t){if(this.resources&&this.resources.previewIds){var n,a=[],r={width:e,height:t};return angular.forEach(this.resources.previewIds,function(e,t){n=t,a[n]="TODOid="+e+"&",angular.forEach(r,function(e,t){a[n]+=t+"="+e+"&"})}),a}},e.prototype.getWebSource=function(e){var t,n;return t=e?"ARCHIVE":"DEFAULT",n=_.findWhere(this.webSources,{type:"CONTENT",kind:t,contentType:"reader/html"})||_.findWhere(this.webSources,{type:"CONTENT",kind:"SOURCE",contentType:"reader/html"}),_.isUndefined(n)&&(n=_.findWhere(this.webSources,{type:"CONTENT",kind:t,contentType:"reader/flash"})),n},e.prototype._parseHtmlDescription=function(){this.description&&this.description.length>0&&(this.description=this.description.replace(/\n/g,"<br />"))},e.prototype.canBeRead=function(){return this.acquired},e.prototype.canBeBought=function(){return!this.acquired&&!this.canBeDownloaded()},e.prototype.canBeDownloaded=function(){return!this.acquired&&this.acquirableViaSubsciption},e}angular.module("aqf.app.issue").factory("AqfIssueModel",e)}(),function(){"use strict";angular.module("aqf.app.deeplink",["aqf.app.voucher"])}(),function(){"use strict";function e(e,t,n,a){function r(){e.$on("$locationChangeStart",function(){var e=t.search();_.each(_.keys(e),function(t){s.deeplink(t,e[t])})})}function i(e,t){"voucher"===e&&(n.voucherCode=t,n.addVoucher().then(function(){s.createModalInfo(!0,e)},function(){s.createModalInfo(!1,e,n.errorVoucher)}))}function o(n,r,i){var o=e.$new(!0);o.info={success:n,name:r,error:i};var s=a.open({scope:o,templateUrl:"components/deeplink/template/modal.deeplink.info.html"});s.result["finally"](function(){t.search(r,null),t.replace()})}var s={init:r,deeplink:i,createModalInfo:o};return s}e.$inject=["$rootScope","$location","voucherService","$uibModal"],angular.module("aqf.app.deeplink").factory("deeplinkService",e)}(),function(){"use strict";angular.module("aqf.app.category",["ngResource","aqf.app.titles","aqf.app.issue","aqf.app.analytics"])}(),function(){"use strict";function e(e,t,n,a,r,i){function o(t,r){var i=e.defer();return n.get({categoryId:t,locale:r},function(e){if(e&&e.result&&e.result.status&&"0"===e.result.status&&e.data&&e.data.category){var t=new a(e.data.category);i.resolve(t)}else i.reject("kioskCategoryResource.get went wrong : bad response >> ",e)},function(e){i.reject(e)}),i.promise}function s(t,a){var r=e.defer(),i=[];return a=a||"title",n.getAll({locale:t},function(e){_.isObject(e.data)&&_.isArray(e.data.categories)?(_.each(e.data.categories,function(e){e.category.typeContained===a&&i.push(e)}),u.allCategories=i,r.resolve(i)):r.reject(e)},function(e){r.reject(e)}),r.promise}function l(t){var a=e.defer();return n.getMenu({locale:t},function(e){_.isObject(e.data)&&_.isArray(e.data.categories)?a.resolve(e.data.categories):a.reject(e)},function(e){a.reject(e)}),a.promise}function c(a,o){var s=e.defer(),l="";"title"===o||"issue"===o?l=o+"s":"category"===o&&(l="categories");var c={categoryId:a};return n.getContent(c,{},function(e){if(e&&e.result.status&&"0"===e.result.status&&e.data&&e.data.content){var n=[];angular.forEach(e.data.content[l],function(e){var t;switch(o){case"title":t=new r(e.title);break;case"issue":t=new i(e.issue)}n.push(t)}),s.resolve(n)}else t.debug("No categories available"),s.reject(e)},function(e){s.reject(e)}),s.promise}var u={isSidebarDisplay:!1,allCategories:[],get:o,getAll:s,getContent:c,getMenu:l};return u}e.$inject=["$q","$log","kioskCategoryResource","CategoryModel","TitleModel","AqfIssueModel"],angular.module("aqf.app.category").factory("kioskCategoryService",e)}(),function(){"use strict";angular.module("aqf.app.category").factory("kioskCategoryResource",["$resource",function(e){return e("api/:pattern/:service",{},{get:{method:"GET",params:{pattern:"category",service:"get"},data:{token:"",categoryId:"",locale:""}},getAll:{method:"GET",params:{pattern:"category",service:"getAll"},data:{token:"",locale:""}},getContent:{method:"GET",params:{pattern:"category",service:"getContent"},data:{token:"",categoryId:""}},getMenu:{method:"GET",params:{pattern:"navigationMenu",service:"get"}}})}])}(),function(){"use strict";angular.module("aqf.app.category").factory("CategoryModel",[function(){var e=function(e){this.id="",this.name="",this.description="",this.headerImages=[],this.mediaUrls=[],this.kind="",this.childCount="",this.issueCount="",this.issues=[],angular.isDefined(e)&&this.parse(e)};return e.prototype.parse=function(e){if(e){var t=this;angular.forEach(e,function(e,n){t[n]=e})}},e}])}(),function(){"use strict";angular.module("aqf.webSocket",["ngWebSocket"])}(),function(){"use strict";function e(e,t){function n(){var n="ws://"+e._electron.host+":"+e._electron.port+"/";i=t(n)}function a(e){null===i&&o.init(),i.onMessage(function(t){e(t)})}function r(e){null===i&&o.init(),i.send(e)}var i=null,o={init:n,onMessage:a,send:r};return o}e.$inject=["$window","$websocket"],angular.module("aqf.webSocket").factory("aqfWebSocketService",e)}(),function(){"use strict";angular.module("aqf.scroll",[])}(),function(){"use strict";function e(e,t,n,a,r){function i(){e.$applyAsync(function(){e.$scroll={top:t.get(0).scrollTop,left:t.get(0).scrollLeft}})}var o;o="BODY"===t.get(0).tagName?n:t,o.bind("scroll",i),e.$on("$destroy",function(){o.off("scroll",i)})}function t(){return{restrict:"A",controller:"AqfScrollController"}}
e.$inject=["$scope","$element","$document","$log","aqfConfigService"],angular.module("aqf.scroll").controller("AqfScrollController",e).directive("aqfScroll",t)}(),function(){"use strict";angular.module("aqf.kioskModeDetector",["aqf.app.analytics"])}(),function(){"use strict";function e(e,t){function a(){return"undefined"!=typeof e._electron}function r(){return l}function i(e){l=e}function o(){return c}function s(e){c=e,e&&n.analytics?_.each(n.analytics.vendors,function(e,n){t.setTrackId(n,e.trackId,e.options)}):t.setTrackId(null)}var l=!1,c=!1,u={isDesktopMode:a,isOffline:r,setOfflineMode:i,isTrackableMode:o,setTrackableMode:s};return u}function t(){var t=this;t.setConfig=function(e){n=e},t.$get=e}e.$inject=["$window","aqfAnalyticsService"],angular.module("aqf.kioskModeDetector").provider("aqfKioskModeDetectorService",t);var n={}}(),function(){"use strict";angular.module("aqf.config",[])}(),function(){"use strict";function e(){function e(){return n.config}var t={getConfig:e};return t}function t(){var t=this;t.setConfig=function(e){n.config=e},t.$get=e}angular.module("aqf.config").provider("aqfConfigService",t);var n={}}(),function(){"use strict";function e(e,t,n,a,r){if(!t.aqfConfig)return void a.error("aqf-config is empty config is not include in scope");var i=n(t.aqfConfig).assign;i(e,r.getConfig())}function t(){return{restrict:"A",controller:"AqfConfigController",controllerAs:"AqfConfigController"}}e.$inject=["$scope","$attrs","$parse","$log","aqfConfigService"],angular.module("aqf.config").controller("AqfConfigController",e).directive("aqfConfig",t)}(),function(){"use strict";angular.module("aqf.app.analytics",["aqf.analytics","aqf.analytics.google","aqf.analytics.localytics","aqf.analytics.piwik","aqf.analytics.aqualytics","aqf.kioskModeDetector"])}(),function(){"use strict";function e(e,t){function n(n,a){t.isTrackableMode()&&e.sendEventTrack(n,a)}function a(n){t.isTrackableMode()&&n!==r&&(e.sendPageTrack(n),r=n)}var r="";return{sendEventTrack:n,sendPageTrack:a}}e.$inject=["aqfAnalyticsService","aqfKioskModeDetectorService"],angular.module("aqf.app.analytics").factory("aqfAppAnalyticsService",e)}(),function(){"use strict";angular.module("aqf.webkiosk.content",["aqf.ui.router","aqf.webkiosk.app"])}(),function(){"use strict";angular.module("aqf.utils.services",[])}(),function(){"use strict";angular.module("aqf.utils.services").service("DateUtils",[function(){this.getDateWithMaxTime=function(e){return e&&angular.isDate(e)&&(e.setHours(23),e.setMinutes(59),e.setSeconds(59),e.setMilliseconds(0)),e}}])}(),function(){angular.module("aqf.webkiosk.storage",[])}(),function(){"use strict";angular.module("aqf.webkiosk.storage").service("kioskStorageService",["$window",function(e){function t(){return"localStorage"in e}function n(){return"sessionStorage"in e}var a={};this.get=function(a){var r;return a&&t()?r=e.localStorage:!a&&n()&&(r=e.sessionStorage),r},this.checkValidity=function(){if(this.available){var e=this.get(a.useLocalStorage).getItem("[[vendor]].version");(angular.isUndefined(e)||"[[pkg.version]]"!==e)&&(this._clearLocalData(),this.get(a.useLocalStorage).setItem("[[vendor]].version","[[pkg.version]]"))}},this._clearLocalData=function(){this.available&&this.get(a.useLocalStorage).clear()},this.available=t()||n()}])}(),function(){"use strict";function e(){function e(e){for(var t={},n=["issue","reader","locationType","section","spread","page"],a=e.split("/"),r=1,i=!0;i;)_.contains(n,a[r])?(t[a[r]]=a[r+1],r+=2):r++,i=r<a.length;return t}return{parseReaderDeepLink:e}}angular.module("aqf.app.reader").factory("kioskReaderService",e)}(),function(){"use strict";angular.module("aqf.app.offline",["aqf.kioskModeDetector","aqf.navigation"])}(),function(){"use strict";function e(e,t,n,a){function r(){e.online=navigator.onLine,n.setOfflineMode(!navigator.onLine),a.toggleDisplayedItemsForOffline(navigator.onLine),t.addEventListener("offline",function(){e.$apply(function(){e.online=!1})},!1),t.addEventListener("online",function(){e.$apply(function(){e.online=!0})},!1)}var i={init:r};return i}e.$inject=["$rootScope","$window","aqfKioskModeDetectorService","navigationService"],angular.module("aqf.app.offline").factory("kioskOfflineService",e)}(),function(){"use strict";angular.module("aqf.wekiosk.moment",[])}(),function(){"use strict";function e(e){function t(t){var n=e.utc();return t>0?n.add(t,"ms"):t<0&&n.subtract(Math.abs(t),"ms"),n}var n={nowWithDiff:t};return n}angular.module("aqf.wekiosk.moment").factory("momentService",e),e.$inject=["moment"]}(),function(){"use strict";function e(e,t){return{restrict:"E",scope:{momentFormat:"=",momentDiff:"="},templateUrl:"moment/template/moment.counter.template.html",link:function(n){function a(){n.result=t.nowWithDiff(n.momentDiff).format(n.momentFormat),i===!1&&r(1e3)}function r(t){e(function(){a()},t)}var i=!1;a(),r(),n.$on("$destroy",function(){i=!0})}}}e.$inject=["$timeout","momentService"],angular.module("aqf.wekiosk.moment").directive("momentCounter",e),e.$injector=["$timeout","momentService"]}(),function(){"use strict";angular.module("aqf.wekiosk.moment").constant("moment",moment)}(),function(){"use strict";angular.module("aqf.app.issue").value("currentIssue",{data:null,close:null,showModalClose:!0})}(),function(){angular.module("aqf.webkiosk.cache",["aqf.webkiosk.storage"])}(),function(){"use strict";angular.module("aqf.webkiosk.cache").service("kioskCacheService",["$filter","$log","$q","$http","$timeout","$window","kioskStorageService",function(e,t,n,a,r,i,o){function s(e){var t;return o.available&&e&&(t=o.get(h.useLocalStorage).getItem(b(e.email))),null===t&&(t=void 0),angular.isString(t)&&(t=angular.fromJson(t)),t}function l(e,t){o.available&&e&&(t?(t=angular.toJson(t),o.get(h.useLocalStorage).setItem(b(e.email),t)):o.get(h.useLocalStorage).removeItem(b(e.email)))}function c(){k={titles:[],latestIssues:[],globalMap:{},featuredItems:[],acquiredIssues:[],moreAcquiredIssues:!1,acquiredIssuesOffset:0,subscriptionProducts:[],categories:[],firstLoad:{acquiredIssues:!0},bookmarks:[],notes:[],applicationCaches:[],referenceCaches:[]}}function u(){t.error("not implemented")}function f(e){t.error("not implemented")}function d(e){t.error("not implemented")}var g,p,m,h={},v={bookmarks:[],notes:[],applicationCaches:[],referenceCaches:[]},k={titles:[],latestIssues:[],globalMap:{},featuredItems:[],acquiredIssues:[],moreAcquiredIssues:!1,acquiredIssuesOffset:0,subscriptionProducts:[],categories:[],firstLoad:{acquiredIssues:!0},bookmarks:[],notes:[],applicationCaches:[],referenceCaches:[],modalSynchroDiffIsOpen:!1};this.getModel=function(){return k},this.deleteCachedModel=function(){c(),l(g,void 0)},this.save=function(){l(g,k)},this.getApplicationCaches=function(t,n){return e("filter")(k.applicationCaches,function(e){return e.userId===n&&e.appId===t})[0]},this.setApplicationCaches=function(t){var n=e("filter")(k.applicationCaches,function(e){return e.userId===e.userId&&e.appId===e.appId})[0],a=k.applicationCaches.indexOf(n);a===-1?k.applicationCaches.push(t):k.applicationCaches[a]=t,l(g,k)},this.readStorage=function(e){if(e||angular.isUndefined(m)){if(m=n.defer(),o.checkValidity(),o.available&&(g=u(),p=d(g),p&&null!==p||(g=void 0,f(void 0),m.resolve()),g&&g.email&&h.useLocalStorage)){c();var a=s(g);if(a)try{angular.isObject(a)&&angular.forEach(a,function(e,t){if(v.hasOwnProperty(t))if(angular.isFunction(v[t])){var n,a=[];angular.forEach(e,function(e){n=new v[t](e),a.push(n)}),k[t]=a}else k[t]=e})}catch(r){t.error("error parse old model",r)}}m.resolve()}return m.promise},this.getAllBookmarks=function(){return k.bookmarks},this.setAllBookmarks=function(e){k.bookmarks=e,l(g,k)},this.addBookmark=function(e){k.bookmarks.push(e),l(g,k)},this.removeBookmark=function(t){var n=this.getAllBookmarks(),a=e("filter")(n,function(e){return e.parent===t.parent&&e.item_id===t.item_id})[0];n.splice(n.indexOf(a),1)},this.getBookmark=function(t,n){return e("filter")(k.bookmarks,function(e){return e.parent.split("#")[1]===t&&e.item_id===n})[0]},this.getBookmarkByPage=function(t,n,a,r){this.getBookmarksByIssue(t);return e("filter")(k.bookmarks,function(e){var t=e.reference.split("/"),i=parseInt(t[0],10),o=parseInt(t[1],10),s=parseInt(t[2],10);return i===n&&o===a&&s===r})[0]},this.getBookmarksByIssue=function(t){return e("filter")(k.bookmarks,function(e){return e.parent.split("#")[1]===t})},this.getAllNotes=function(){return k.notes},this.setAllNotes=function(e){k.notes=e,l(g,k)},this.addNote=function(e){k.notes.push(e),l(g,k)},this.updateNote=function(e){var t=_.findWhere(k.notes,{item_id:e.item_id});if(_.isObject(t)){var n=_.indexOf(k.notes,t);k.notes.splice(n,1,e),l(g,k)}},this.removeNote=function(e){var t=this.getAllNotes(),n=_.find(t,function(t){return t.parent===e.parent&&t.item_id===e.item_id});_.isObject(n)&&t.splice(_.indexOf(t,n),1)},this.getNote=function(t,n){return e("filter")(k.notes,function(e){return e.parent.split("#")[1]===t&&e.item_id===n})[0]},this.getNotesByIssue=function(t){return e("filter")(k.notes,function(e){return e.parent.split("#")[1]===t})},this.getAnnotationsAfterDate=function(t,n){var a=k.bookmarks.concat(k.notes);return e("filter")(a,function(e){return e.parent.split("#")[1]===t&&e.modification_date>n})},this.getReferenceCaches=function(t,n,a){var r=t+"#"+n;return e("filter")(k.referenceCaches,function(e){return e.ref_cache_id===r&&e.modification_date>a})},this.setReferenceCaches=function(t){var n=e("filter")(k.referenceCaches,function(e){return e.ref_cache_id===t.ref_cache_id&&e.ref_id===t.ref_id})[0],a=k.referenceCaches.indexOf(n);a===-1?k.referenceCaches.push(t):k.referenceCaches[a].modification_date=t.modification_date,l(g,k)},this.getModalSynchroDiffIsOpen=function(){return k.modalSynchroDiffIsOpen},this.setModalSynchroDiffIsOpen=function(e){k.modalSynchroDiffIsOpen=e,l(g,k)};var b=function(e){return e&&""!==e||(e="anonymous"),"[[vendor]]."+e}}])}(),angular.module("aqf.webkiosk.component.auth",["ngResource","ngCookies","aqf.app.analytics","angular-jwt"]),function(){"use strict";angular.module("aqf.webkiosk.component.auth").factory("KioskRightsResource",["$resource",function(e){return e("api/:pattern/:service",{pattern:"rights"},{update:{method:"GET",params:{service:"update"}}})}])}(),function(){"use strict";var e={userInfo:null,hash:null,userId:null,isAnonymous:null,deferIsConnect:null,firebaseToken:null,firebaseUserId:null,publisherId:null};angular.module("aqf.webkiosk.component.auth").value("kioskAuthValue",e)}(),function(){"use strict";function e(){var e=this;e.setConfig=function(e){n=e},e.$get=t}function t(e,t,a,r,i,o,s,l,c,u){function f(){var t=a.defer(),n={uid:I(10),rememberMe:!1};return r.hello({},n,function(n){n.data&&n.result&&"0"===n.result.status?(o.isAnonymous=!0,o.hash=n.data.token,e.put($,"1"),e.put(C,n.data.token),t.resolve()):t.reject("The Hello went wrong - bad response - ",n)},function(e){t.reject("The Hello went wrong ",e)}),t.promise}function d(t){var n;u.sendEventTrack("va_login");var f=a.defer();return r.link({},t,function(r){if(r.data&&r.result&&"0"===r.result.status)r.data.firebase&&(n=c.decodeToken(r.data.firebase),o.publisherId=n.claims.publisherId,o.firebaseUserId=n.uid,o.firebaseToken=r.data.firebase,e.put(A,r.data.firebase)),o.isAnonymous=!1,o.hash=r.data.token,o.userId=t.email,o.userInfo=r.data,e.put(C,r.data.token),e.put($,"0"),e.put(T,t.email),s.update(),l.isDesktopMode()&&i.userLoggedIn({},{email:t.email,token:r.data.token,userInfo:r.data}),o.deferIsConnect=a.defer(),o.deferIsConnect.resolve(),f.resolve();else if(r.result&&"216"===r.result.status){var u=D.getSessionId(),d=D.isAnonymous(),g=D.getFirebaseToken();_.isEmpty(u)||d!==!1?f.reject("The Link went wrong - bad response - ",r):(_.isUndefined(g)||(n=c.decodeToken(g),o.publisherId=n.claims.publisherId,o.firebaseUserId=n.uid),o.deferIsConnect=a.defer(),o.deferIsConnect.resolve(),f.resolve())}else f.reject("The Link went wrong - bad response - ",r)},function(e){f.reject("The Link went wrong ",e)}),f.promise}function g(){u.sendEventTrack("va_logout");var t=a.defer();return r.unlink({},{},function(n){n.data&&n.result&&"0"===n.result.status?(D.clean(),e.put(C,n.data.token),e.put($,"1"),l.isDesktopMode()&&i.userLoggedOut(),t.resolve()):t.reject()},function(e){t.reject(e)}),t.promise}function p(){if(!_.isObject(o.deferIsConnect))if(t.info("First connection."),o.deferIsConnect=a.defer(),l.isOffline()&&l.isDesktopMode())i.userIsLoggedIn({},{},function(e){_.isUndefined(e)?o.deferIsConnect.reject():o.deferIsConnect.resolve()},function(){o.deferIsConnect.reject()});else{var e=D.getSessionId(),n=D.isAnonymous(),r=D.getFirebaseToken();_.isString(e)&&!_.isEmpty(e)&&n===!1?D.hello().then(function(e){if(t.info("User is connected"),!_.isUndefined(r)){var n=c.decodeToken(r);o.publisherId=n.claims.publisherId,o.firebaseUserId=n.uid}s.update(),o.deferIsConnect.resolve()},function(){t.info("Token is invalid"),o.deferIsConnect.reject(),D.clean(),D.helloAnonymous()}):(t.info("no token"),D.helloAnonymous(),o.deferIsConnect.reject())}return o.deferIsConnect.promise}function m(){return _.isNull(o.hash)&&(o.hash=e.get(C)),o.hash}function h(){return _.isNull(o.userId)&&(o.userId=e.get(T)),o.userId}function v(){return _.isNull(o.firebaseToken)&&(o.firebaseToken=e.get(A)),o.firebaseToken}function k(){var e=null;return _.isNull(o.publisherId)||(e={publisherId:o.publisherId,uid:o.firebaseUserId}),e}function b(){var t=a.defer(),n={email:D.getUserId(),publisherId:o.publisherId};return r.firebaseRenewToken({},n,function(n){if(n.result&&"0"===n.result.status&&n.data){var a=c.decodeToken(n.data);o.publisherId=a.claims.publisherId,o.firebaseUserId=a.uid,o.firebaseToken=n.data,e.put(A,n.data),t.resolve(n.data)}else t.reject(n.status)},function(e){t.reject(e)}),t.promise}function y(){if(_.isNull(o.isAnonymous)){var t=e.get($);o.isAnonymous=!_.isUndefined(t)&&"1"===t}return o.isAnonymous}function I(e){var t="0123456789ABCDEFGHIJKLMNOPQRSTUVWXTZabcdefghiklmnopqrstuvwxyz";e=e||12;for(var n="",a=0;a<e;a++){var r=Math.floor(Math.random()*t.length);n+=t.substring(r,r+1)}return n}function q(){var e=a.defer(),t={uid:D.getUserId(),rememberMe:!1};return r.hello({},t,function(t){o.userInfo=t.data,e.resolve(t.data)},function(t){e.reject(t)}),e.promise}function w(){o.userInfo=null,o.hash=null,o.userId=null,o.deferIsConnect=null,o.isAnonymous=null,o.firebaseToken=null,o.publisherId=null,o.firebaseUserId=null,e.remove($),e.remove(C),e.remove(T),e.remove(A)}function S(){u.sendEventTrack("va_skipLogin")}var C=n.authConfig.sessionKeyPrefix+n.app.applicationDetails.bundleId,$=n.authConfig.isAnonKeyPrefix+n.app.applicationDetails.bundleId,T=n.authConfig.userIdKeyPrefix+n.app.applicationDetails.bundleId,A="firebaseToken."+n.app.applicationDetails.bundleId,L=function(){u.sendPageTrack("account")};L();var D={helloAnonymous:f,login:d,logout:g,checkForActiveSession:p,getSessionId:m,isAnonymous:y,getUserId:h,hello:q,clean:w,getFirebaseToken:v,getFirebaseInfo:k,firebaseRenewToken:b,onClickOnClose:S};return D}t.$inject=["$cookies","$log","$q","KioskAuthResource","KioskOfflineAuthResource","kioskAuthValue","KioskRightsResource","aqfKioskModeDetectorService","jwtHelper","aqfAppAnalyticsService"],angular.module("aqf.webkiosk.component.auth").provider("kioskAuthService",e);var n={}}(),function(){"use strict";angular.module("aqf.webkiosk.component.auth").factory("KioskAuthResource",["$resource",function(e){return e("api/:pattern/:service",{},{hello:{method:"POST",params:{pattern:"hello"},data:{token:"",email:"",password:"",uid:""}},link:{method:"POST",params:{pattern:"account",service:"link"},data:{token:"",email:"",password:""}},unlink:{method:"POST",params:{pattern:"account",service:"unlink"},data:{token:""}},checkForActiveSession:{method:"POST",params:{pattern:"getSetupData",service:""},data:{token:""}},firebaseRenewToken:{method:"POST",params:{pattern:"firebase",service:"renewToken"},data:{token:"",version:10,email:"",publisherId:""}}})}]).factory("KioskOfflineAuthResource",["$resource",function(e){return e("offline/:pattern/:service",{},{userIsLoggedIn:{method:"GET",params:{pattern:"user",service:"isLoggedIn"},data:{}},userLoggedIn:{method:"POST",params:{pattern:"user",service:"loggedIn"},data:{token:"",email:""}},userLoggedOut:{method:"POST",params:{pattern:"user",service:"loggedOut"},data:{}}})}])}(),function(){"use strict";angular.module("aqf.webkiosk",["aqf.scroll","aqf.ui.router","ngCookies","ngAnimate","aqf.config","aqf.auth","aqf.webkiosk.content","aqf.storemodel.component.link","aqf.storemodel.component.link.interceptor","aqf.webkiosk.component.auth","aqf.webkiosk.config","aqf.storemodel","aqf-storemodel.tpl","aqf.app.analytics","aqf.app.deeplink","aqf.kioskModeDetector","aqf.webSocket","aqf.app.offline"])}(),function(){"use strict";function e(e,t,n){t.setAnalyticsService("aqfAppAnalyticsService"),t.setKyashuUrl(e.app.access.kyashuUrl),t.setGlobalOptions({linkConfig:{state:"$$itemType",title:"",params:{itemId:"$$itemId"}},smLinkConfig:{state:"storemodelwithlang",title:"",params:{smkey:"$$itemId",smlocale:e.language.locale}},seeAllLinkConfig:{state:"$$itemType",title:"",params:{itemId:"$$itemId"}},spotLightLinksParams:{more:{state:"$$itemType",title:"",params:{itemId:"$$itemId"}},read:{state:"read",title:"",params:{itemId:"$$itemId"}}}}),n.interceptors.push("StoreModelComponentLinkDefaultService")}e.$inject=["configKiosk","StoreModelServiceProvider","StoreModelComponentLinkServiceProvider"],angular.module("aqf.webkiosk").config(e)}(),function(){"use strict";function e(e,t){t.setConfig(e)}e.$inject=["configKiosk","kioskSearchServiceProvider"],angular.module("aqf.webkiosk").config(e)}(),function(){"use strict";function e(e,t){var n="";switch(t.navigation.item[0].key){default:case"home":n="/"+t.language.locale+"/";break;case"library":n="/"+t.language.locale+"/library";break;case"titles":n="/"+t.language.locale+"/titles"}e.when("",n),e.when("/",n),e.otherwise("/"+t.language.locale+"/404")}e.$inject=["$urlRouterProvider","configKiosk"],angular.module("aqf.webkiosk").config(e)}(),function(){"use strict";function e(e,t,n){t.useStaticFilesLoader({prefix:"i18n/",suffix:".json"}),t.preferredLanguage(e.language.locale),t.useSanitizeValueStrategy(null),n.setLanguages(e.language.locale,e.language.availableLocales)}e.$inject=["configKiosk","$translateProvider","aqfI18nServiceProvider"],angular.module("aqf.webkiosk").config(e)}(),function(){function e(e,n){e.factory("queryInterceptor",["$injector",t]),n.interceptors.push("queryInterceptor")}function t(e){function t(t){var n=l.defer();return t.data&&t.data.result&&"201"===t.data.result.status?(o=o||e.get("kioskAuthService"),n.reject(),o.clean(),o.helloAnonymous().then(function(){window.location.reload(!0)})):n.resolve(t),n.promise}function n(t){var n=l.defer();return 0===t.url.indexOf("api/")||0===t.url.indexOf("/api/")?(o=o||e.get("kioskAuthService"),s=s||e.get("configKiosk"),a(t,n)):0===t.url.indexOf("offline/")||0===t.url.indexOf("/offline/")?(o=o||e.get("kioskAuthService"),s=s||e.get("configKiosk"),r(t,n)):0===t.url.indexOf("search/")||0===t.url.indexOf("/search/")?(o=o||e.get("kioskAuthService"),s=s||e.get("configKiosk"),i(t,n)):n.resolve(t),n.promise}function a(e,t){var n,a=/\/?api\/([a-zA-Z]*)\/?([a-zA-Z]*)/.exec(e.url),r=a[1],i=a[2];if(e.params=e.params||{},e.params.pattern=r,e.params.service=i,s.debug&&(e.params.debug=!0),angular.isObject(window._electron)){var l=angular.isString(window._electron.protocol)?window._electron.protocol:"http",c=angular.isString(window._electron.host)?window._electron.host:"127.0.0.1",u=angular.isNumber(window._electron.port)?window._electron.port:3e3;e.url=l+"://"+c+":"+u+"/"+s.remoteUrl}else e.url=s.remoteUrl;"hello"!==r?(n=o.getSessionId(),_.isString(n)&&!_.isEmpty(n)?(e.params.token=n,t.resolve(e)):o.helloAnonymous().then(function(){n=o.getSessionId(),e.params.token=n,t.resolve(e)})):t.resolve(e)}function r(e,t){var n=window._electron&&angular.isString(window._electron.protocol)?window._electron.protocol:"http",a=window._electron&&angular.isString(window._electron.host)?window._electron.host:"127.0.0.1",r=window._electron&&angular.isNumber(window._electron.port)?window._electron.port:3e3;e.url=n+"://"+a+":"+r+"/"+e.url,t.resolve(e)}function i(e,t){var n=/\/?search\/([a-zA-Z]*)\/?([a-zA-Z]*)/.exec(e.url);e.headers["Content-Type"]="application/json",e.params=e.params||{},e.url=s.searchApiUrl+n[1]+"/"+n[2]+"/_search";var a=o.getSessionId();_.isString(a)&&!_.isEmpty(a)?(e.params.token=a,t.resolve(e)):o.helloAnonymous().then(function(){a=o.getSessionId(),e.params.token=a,t.resolve(e)})}var o,s,l=e.get("$q");return{response:t,request:n}}angular.module("aqf.webkiosk").config(["$provide","$httpProvider",e])}(),function(){"use strict";function e(e,t,n){t.setConfig(e),n.setInterceptor("kioskAuthService"),n.setHomeState(e.navigation.defaultHome||e.navigation.item[0].key)}e.$inject=["configKiosk","kioskAuthServiceProvider","aqfAuthServiceProvider"],angular.module("aqf.webkiosk").config(e)}(),function(){"use strict";function e(e,t,n,a,r){t.setConfig(e),n.setConfig(e),a.setConfig(e),r.setConfig(e)}e.$inject=["configKiosk","aqfConfigServiceProvider","aqfTitleConfigServiceProvider","aqfLibraryServiceProvider","aqfKioskModeDetectorServiceProvider"],angular.module("aqf.webkiosk").config(e)}(),function(){"use strict";function e(e,t,n){n&&n.analytics&&(e.virtualPageviews(n.analytics.autoPageTrack),_.each(n.analytics.vendors,function(e,n){t.addMap(n,e.map)}))}e.$inject=["$analyticsProvider","aqfAnalyticsServiceProvider","configKiosk"],angular.module("aqf.webkiosk").config(e)}(),function(){"use strict";angular.module("aqf.webkiosk").decorator("aqfAuthDirective",["$delegate",function(e){var t=_.first(e);return t.templateUrl="app/templates/aqf-auth.html",e}])}(),function(){"use strict";angular.module("aqf.webkiosk").run(["$timeout","$rootScope","$state","aqfAuthService","deeplinkService","kioskOfflineService","aqfKioskModeDetectorService","configKiosk",function(e,t,n,a,r,i,o,s){a.init(),r.init(),i.init(),t.$on("$stateChangeStart",function(e,t,a){t.redirectTo&&(e.preventDefault(),"defaultHome"===t.redirectTo&&(navigator.onLine?t.redirectTo=s.navigation.item[0].key:t.redirectTo="offlineLibrary"),n.go(t.redirectTo,a,{location:"replace"}))}),e(function(){o.setTrackableMode(!0)})}])}();